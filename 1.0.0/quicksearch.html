<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"node_modules_js-data-adapter_src_index.js.html":{"id":"node_modules_js-data-adapter_src_index.js.html","title":"Source: node_modules/js-data-adapter/src/index.js","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Source: node_modules/js-data-adapter/src/index.js import { Component, utils } from 'js-data' export const noop = function (...args) { const opts = args[args.length - 1] this.dbg(opts.op, ...args) return utils.resolve() } export const noop2 = function (...args) { const opts = args[args.length - 2] this.dbg(opts.op, ...args) return utils.resolve() } export const unique = function (array) { const seen = {} const final = [] array.forEach(function (item) { if (item in seen) { return } final.push(item) seen[item] = 0 }) return final } export const withoutRelations = function (mapper, props, opts) { opts || (opts = {}) opts.with || (opts.with = []) const relationFields = mapper.relationFields || [] const toStrip = relationFields.filter((value) =&gt; opts.with.indexOf(value) === -1) return utils.omit(props, toStrip) } export const reserved = [ 'orderBy', 'sort', 'limit', 'offset', 'skip', 'where' ] /** * Response object used when `raw` is `true`. May contain other fields in * addition to `data`. * * @class Response */ export function Response (data, meta, op) { meta || (meta = {}) /** * Response data. * * @name Response#data * @type {*} */ this.data = data utils.fillIn(this, meta) /** * The operation for which the response was created. * * @name Response#op * @type {string} */ this.op = op } const DEFAULTS = { /** * Whether to log debugging information. * * @name Adapter#debug * @type {boolean} * @default false */ debug: false, /** * Whether to return a more detailed response object. * * @name Adapter#raw * @type {boolean} * @default false */ raw: false } /** * Abstract class meant to be extended by adapters. * * @class Adapter * @abstract * @extends Component * @param {Object} [opts] Configuration opts. * @param {boolean} [opts.debug=false] Whether to log debugging information. * @param {boolean} [opts.raw=false] Whether to return a more detailed response * object. */ export function Adapter (opts) { utils.classCallCheck(this, Adapter) Component.call(this, opts) opts || (opts = {}) utils.fillIn(opts, DEFAULTS) utils.fillIn(this, opts) } Component.extend({ constructor: Adapter, /** * Lifecycle method method called by &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the count. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * * @name Adapter#afterCount * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * @property {string} opts.op `afterCount` * @param {Object|Response} response Count or {@link Response}, depending on the value of `opts.raw`. */ afterCount: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the created record. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * * @name Adapter#afterCreate * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * @property {string} opts.op `afterCreate` * @param {Object|Response} response Created record or {@link Response}, depending on the value of `opts.raw`. */ afterCreate: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the created records. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * * @name Adapter#afterCreate * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * @param {Object[]} props The `props` argument passed to &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * @property {string} opts.op `afterCreateMany` * @param {Object[]|Response} response Created records or {@link Response}, depending on the value of `opts.raw`. */ afterCreateMany: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be `undefined`. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * * @name Adapter#afterDestroy * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * @param {(string|number)} id The `id` argument passed to &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * @property {string} opts.op `afterDestroy` * @param {undefined|Response} response `undefined` or {@link Response}, depending on the value of `opts.raw`. */ afterDestroy: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be `undefined`. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * * @name Adapter#afterDestroyAll * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * @property {string} opts.op `afterDestroyAll` * @param {undefined|Response} response `undefined` or {@link Response}, depending on the value of `opts.raw`. */ afterDestroyAll: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the found record, if any. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * * @name Adapter#afterFind * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * @param {(string|number)} id The `id` argument passed to &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * @property {string} opts.op `afterFind` * @param {Object|Response} response The found record or {@link Response}, depending on the value of `opts.raw`. */ afterFind: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the found records, if any. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * * @name Adapter#afterFindAll * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * @property {string} opts.op `afterFindAll` * @param {Object[]|Response} response The found records or {@link Response}, depending on the value of `opts.raw`. */ afterFindAll: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the sum. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * * @name Adapter#afterSum * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @param {string} field The `field` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @property {string} opts.op `afterSum` * @param {Object|Response} response Count or {@link Response}, depending on the value of `opts.raw`. */ afterSum: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the updated record. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * * @name Adapter#afterUpdate * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @param {(string|number)} id The `id` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @property {string} opts.op `afterUpdate` * @param {Object|Response} response The updated record or {@link Response}, depending on the value of `opts.raw`. */ afterUpdate: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the updated records, if any. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * * @name Adapter#afterUpdateAll * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @property {string} opts.op `afterUpdateAll` * @param {Object[]|Response} response The updated records or {@link Response}, depending on the value of `opts.raw`. */ afterUpdateAll: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt; to wait for the Promise to resolve before continuing. * * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the updated records, if any. * * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * * @name Adapter#afterUpdateMany * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * @param {Object[]} records The `records` argument passed to &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * @property {string} opts.op `afterUpdateMany` * @param {Object[]|Response} response The updated records or {@link Response}, depending on the value of `opts.raw`. */ afterUpdateMany: noop2, /** * Lifecycle method method called by &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt; to wait for the Promise to resolve before continuing. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * * @name Adapter#beforeCount * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#count__anchor&quot;&gt;count&lt;/a&gt;. * @property {string} opts.op `beforeCount` */ beforeCount: noop, /** * Lifecycle method method called by &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt; to wait for the Promise to resolve before continuing. * * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * * @name Adapter#beforeCreate * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#create__anchor&quot;&gt;create&lt;/a&gt;. * @property {string} opts.op `beforeCreate` */ beforeCreate: noop, /** * Lifecycle method method called by &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt; to wait for the Promise to resolve before continuing. * * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * * @name Adapter#beforeCreateMany * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * @param {Object[]} props The `props` argument passed to &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#createMany__anchor&quot;&gt;createMany&lt;/a&gt;. * @property {string} opts.op `beforeCreateMany` */ beforeCreateMany: noop, /** * Lifecycle method method called by &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt; to wait for the Promise to resolve before continuing. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * * @name Adapter#beforeDestroy * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * @param {(string|number)} id The `id` argument passed to &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#destroy__anchor&quot;&gt;destroy&lt;/a&gt;. * @property {string} opts.op `beforeDestroy` */ beforeDestroy: noop, /** * Lifecycle method method called by &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt; to wait for the Promise to resolve before continuing. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * * @name Adapter#beforeDestroyAll * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#destroyAll__anchor&quot;&gt;destroyAll&lt;/a&gt;. * @property {string} opts.op `beforeDestroyAll` */ beforeDestroyAll: noop, /** * Lifecycle method method called by &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt; to wait for the Promise to resolve before continuing. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * * @name Adapter#beforeFind * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * @param {(string|number)} id The `id` argument passed to &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#find__anchor&quot;&gt;find&lt;/a&gt;. * @property {string} opts.op `beforeFind` */ beforeFind: noop, /** * Lifecycle method method called by &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt; to wait for the Promise to resolve before continuing. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * * @name Adapter#beforeFindAll * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#findAll__anchor&quot;&gt;findAll&lt;/a&gt;. * @property {string} opts.op `beforeFindAll` */ beforeFindAll: noop, /** * Lifecycle method method called by &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt; to wait for the Promise to resolve before continuing. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * * @name Adapter#beforeSum * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#sum__anchor&quot;&gt;sum&lt;/a&gt;. * @property {string} opts.op `beforeSum` */ beforeSum: noop, /** * Lifecycle method method called by &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt; to wait for the Promise to resolve before continuing. * * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * * @name Adapter#beforeUpdate * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @param {(string|number)} id The `id` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#update__anchor&quot;&gt;update&lt;/a&gt;. * @property {string} opts.op `beforeUpdate` */ beforeUpdate: noop, /** * Lifecycle method method called by &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt; to wait for the Promise to resolve before continuing. * * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * * @name Adapter#beforeUpdateAll * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @param {Object} props The `props` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @param {Object} query The `query` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#updateAll__anchor&quot;&gt;updateAll&lt;/a&gt;. * @property {string} opts.op `beforeUpdateAll` */ beforeUpdateAll: noop, /** * Lifecycle method method called by &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * * Override this method to add custom behavior for this lifecycle hook. * * Returning a Promise causes &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt; to wait for the Promise to resolve before continuing. * * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value. * * A thrown error or rejected Promise will bubble up and reject the Promise returned by &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * * @name Adapter#beforeUpdateMany * @method * @param {Object} mapper The `mapper` argument passed to &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * @param {Object[]} props The `props` argument passed to &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * @param {Object} opts The `opts` argument passed to &lt;a href=&quot;#updateMany__anchor&quot;&gt;updateMany&lt;/a&gt;. * @property {string} opts.op `beforeUpdateMany` */ beforeUpdateMany: noop, /** * Retrieve the number of records that match the selection query. Called by * `Mapper#count`. * * @name Adapter#count * @method * @param {Object} mapper The mapper. * @param {Object} [query] Selection query. * @param {Object} [query.where] Filtering criteria. * @param {string|Array} [query.orderBy] Sorting criteria. * @param {string|Array} [query.sort] Same as `query.sort`. * @param {number} [query.limit] Limit results. * @param {number} [query.skip] Offset results. * @param {number} [query.offset] Same as `query.skip`. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ count (mapper, query, opts) { let op query || (query = {}) opts || (opts = {}) // beforeCount lifecycle hook op = opts.op = 'beforeCount' return utils.resolve(this[op](mapper, query, opts)) .then(() =&gt; { // Allow for re-assignment from lifecycle hook op = opts.op = 'count' this.dbg(op, mapper, query, opts) return utils.resolve(this._count(mapper, query, opts)) }) .then((results) =&gt; { let [data, result] = results result || (result = {}) let response = new Response(data, result, op) response = this.respond(response, opts) // afterCount lifecycle hook op = opts.op = 'afterCount' return utils.resolve(this[op](mapper, query, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Create a new record. Called by `Mapper#create`. * * @name Adapter#create * @method * @param {Object} mapper The mapper. * @param {Object} props The record to be created. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ create (mapper, props, opts) { let op props || (props = {}) opts || (opts = {}) // beforeCreate lifecycle hook op = opts.op = 'beforeCreate' return utils.resolve(this[op](mapper, props, opts)) .then((_props) =&gt; { // Allow for re-assignment from lifecycle hook props = _props === undefined ? props : _props props = withoutRelations(mapper, props, opts) op = opts.op = 'create' this.dbg(op, mapper, props, opts) return utils.resolve(this._create(mapper, props, opts)) }) .then((results) =&gt; { let [data, result] = results result || (result = {}) let response = new Response(data, result, 'create') response.created = data ? 1 : 0 response = this.respond(response, opts) // afterCreate lifecycle hook op = opts.op = 'afterCreate' return utils.resolve(this[op](mapper, props, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Create multiple records in a single batch. Called by `Mapper#createMany`. * * @name Adapter#createMany * @method * @param {Object} mapper The mapper. * @param {Object} props The records to be created. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ createMany (mapper, props, opts) { let op props || (props = {}) opts || (opts = {}) // beforeCreateMany lifecycle hook op = opts.op = 'beforeCreateMany' return utils.resolve(this[op](mapper, props, opts)) .then((_props) =&gt; { // Allow for re-assignment from lifecycle hook props = _props === undefined ? props : _props props = props.map((record) =&gt; withoutRelations(mapper, record, opts)) op = opts.op = 'createMany' this.dbg(op, mapper, props, opts) return utils.resolve(this._createMany(mapper, props, opts)) }) .then((results) =&gt; { let [data, result] = results data || (data = []) result || (result = {}) let response = new Response(data, result, 'createMany') response.created = data.length response = this.respond(response, opts) // afterCreateMany lifecycle hook op = opts.op = 'afterCreateMany' return utils.resolve(this[op](mapper, props, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Destroy the record with the given primary key. Called by * `Mapper#destroy`. * * @name Adapter#destroy * @method * @param {Object} mapper The mapper. * @param {(string|number)} id Primary key of the record to destroy. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ destroy (mapper, id, opts) { let op opts || (opts = {}) // beforeDestroy lifecycle hook op = opts.op = 'beforeDestroy' return utils.resolve(this[op](mapper, id, opts)) .then(() =&gt; { op = opts.op = 'destroy' this.dbg(op, mapper, id, opts) return utils.resolve(this._destroy(mapper, id, opts)) }) .then((results) =&gt; { let [data, result] = results result || (result = {}) let response = new Response(data, result, 'destroy') response = this.respond(response, opts) // afterDestroy lifecycle hook op = opts.op = 'afterDestroy' return utils.resolve(this[op](mapper, id, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Destroy the records that match the selection query. Called by * `Mapper#destroyAll`. * * @name Adapter#destroyAll * @method * @param {Object} mapper the mapper. * @param {Object} [query] Selection query. * @param {Object} [query.where] Filtering criteria. * @param {string|Array} [query.orderBy] Sorting criteria. * @param {string|Array} [query.sort] Same as `query.sort`. * @param {number} [query.limit] Limit results. * @param {number} [query.skip] Offset results. * @param {number} [query.offset] Same as `query.skip`. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ destroyAll (mapper, query, opts) { let op query || (query = {}) opts || (opts = {}) // beforeDestroyAll lifecycle hook op = opts.op = 'beforeDestroyAll' return utils.resolve(this[op](mapper, query, opts)) .then(() =&gt; { op = opts.op = 'destroyAll' this.dbg(op, mapper, query, opts) return utils.resolve(this._destroyAll(mapper, query, opts)) }) .then((results) =&gt; { let [data, result] = results result || (result = {}) let response = new Response(data, result, 'destroyAll') response = this.respond(response, opts) // afterDestroyAll lifecycle hook op = opts.op = 'afterDestroyAll' return utils.resolve(this[op](mapper, query, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Load a belongsTo relationship. * * Override with care. * * @name Adapter#loadBelongsTo * @method * @return {Promise} */ loadBelongsTo (mapper, def, records, __opts) { const relationDef = def.getRelation() if (utils.isObject(records) &amp;&amp; !utils.isArray(records)) { const record = records return this.find(relationDef, this.makeBelongsToForeignKey(mapper, def, record), __opts) .then((relatedItem) =&gt; { def.setLocalField(record, relatedItem) }) } else { const keys = records .map((record) =&gt; this.makeBelongsToForeignKey(mapper, def, record)) .filter((key) =&gt; key) return this.findAll(relationDef, { where: { [relationDef.idAttribute]: { 'in': keys } } }, __opts).then((relatedItems) =&gt; { records.forEach((record) =&gt; { relatedItems.forEach((relatedItem) =&gt; { if (relatedItem[relationDef.idAttribute] === record[def.foreignKey]) { def.setLocalField(record, relatedItem) } }) }) }) } }, /** * Retrieve the record with the given primary key. Called by `Mapper#find`. * * @name Adapter#find * @method * @param {Object} mapper The mapper. * @param {(string|number)} id Primary key of the record to retrieve. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {string[]} [opts.with=[]] Relations to eager load. * @return {Promise} */ find (mapper, id, opts) { let op opts || (opts = {}) opts.with || (opts.with = []) // beforeFind lifecycle hook op = opts.op = 'beforeFind' return utils.resolve(this[op](mapper, id, opts)) .then(() =&gt; { op = opts.op = 'find' this.dbg(op, mapper, id, opts) return utils.resolve(this._find(mapper, id, opts)) }) .then((results) =&gt; this.loadRelationsFor(mapper, results, opts)) .then(([record, meta]) =&gt; { let response = new Response(record, meta, 'find') response.found = record ? 1 : 0 response = this.respond(response, opts) // afterFind lifecycle hook op = opts.op = 'afterFind' return utils.resolve(this[op](mapper, id, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Retrieve the records that match the selection query. * * @name Adapter#findAll * @method * @param {Object} mapper The mapper. * @param {Object} [query] Selection query. * @param {Object} [query.where] Filtering criteria. * @param {string|Array} [query.orderBy] Sorting criteria. * @param {string|Array} [query.sort] Same as `query.sort`. * @param {number} [query.limit] Limit results. * @param {number} [query.skip] Offset results. * @param {number} [query.offset] Same as `query.skip`. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {string[]} [opts.with=[]] Relations to eager load. * @return {Promise} */ findAll (mapper, query, opts) { let op opts || (opts = {}) opts.with || (opts.with = []) const activeWith = opts._activeWith if (utils.isObject(activeWith)) { const activeQuery = activeWith.query || {} if (activeWith.replace) { query = activeQuery } else { utils.deepFillIn(query, activeQuery) } } // beforeFindAll lifecycle hook op = opts.op = 'beforeFindAll' return utils.resolve(this[op](mapper, query, opts)) .then(() =&gt; { op = opts.op = 'findAll' this.dbg(op, mapper, query, opts) return utils.resolve(this._findAll(mapper, query, opts)) }) .then((results) =&gt; this.loadRelationsFor(mapper, results, opts)) .then(([records, meta]) =&gt; { let response = new Response(records, meta, 'findAll') response.found = records.length response = this.respond(response, opts) // afterFindAll lifecycle hook op = opts.op = 'afterFindAll' return utils.resolve(this[op](mapper, query, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, loadRelationsFor (mapper, results, opts) { const [records] = results const tasks = [] if (records) { utils.forEachRelation(mapper, opts, (def, __opts) =&gt; { let task if (def.foreignKey &amp;&amp; (def.type === 'hasOne' || def.type === 'hasMany')) { if (def.type === 'hasOne') { task = this.loadHasOne(mapper, def, records, __opts) } else { task = this.loadHasMany(mapper, def, records, __opts) } } else if (def.type === 'hasMany' &amp;&amp; def.localKeys) { task = this.loadHasManyLocalKeys(mapper, def, records, __opts) } else if (def.type === 'hasMany' &amp;&amp; def.foreignKeys) { task = this.loadHasManyForeignKeys(mapper, def, records, __opts) } else if (def.type === 'belongsTo') { task = this.loadBelongsTo(mapper, def, records, __opts) } if (task) { tasks.push(task) } }) } return utils.Promise.all(tasks) .then(() =&gt; results) }, /** * Resolve the value of the specified option based on the given options and * this adapter's settings. Override with care. * * @name Adapter#getOpt * @method * @param {string} opt The name of the option. * @param {Object} [opts] Configuration options. * @return {*} The value of the specified option. */ getOpt (opt, opts) { opts || (opts = {}) return opts[opt] === undefined ? utils.plainCopy(this[opt]) : utils.plainCopy(opts[opt]) }, /** * Load a hasMany relationship. * * Override with care. * * @name Adapter#loadHasMany * @method * @return {Promise} */ loadHasMany (mapper, def, records, __opts) { let singular = false if (utils.isObject(records) &amp;&amp; !utils.isArray(records)) { singular = true records = [records] } const IDs = records.map((record) =&gt; this.makeHasManyForeignKey(mapper, def, record)) const query = { where: {} } const criteria = query.where[def.foreignKey] = {} if (singular) { // more efficient query when we only have one record criteria['=='] = IDs[0] } else { criteria['in'] = IDs.filter((id) =&gt; id) } return this.findAll(def.getRelation(), query, __opts).then((relatedItems) =&gt; { records.forEach((record) =&gt; { let attached = [] // avoid unneccesary iteration when we only have one record if (singular) { attached = relatedItems } else { relatedItems.forEach((relatedItem) =&gt; { if (utils.get(relatedItem, def.foreignKey) === record[mapper.idAttribute]) { attached.push(relatedItem) } }) } def.setLocalField(record, attached) }) }) }, loadHasManyLocalKeys (mapper, def, records, __opts) { let record const relatedMapper = def.getRelation() if (utils.isObject(records) &amp;&amp; !utils.isArray(records)) { record = records } if (record) { return this.findAll(relatedMapper, { where: { [relatedMapper.idAttribute]: { 'in': this.makeHasManyLocalKeys(mapper, def, record) } } }, __opts).then((relatedItems) =&gt; { def.setLocalField(record, relatedItems) }) } else { let localKeys = [] records.forEach((record) =&gt; { localKeys = localKeys.concat(this.makeHasManyLocalKeys(mapper, def, record)) }) return this.findAll(relatedMapper, { where: { [relatedMapper.idAttribute]: { 'in': unique(localKeys).filter((x) =&gt; x) } } }, __opts).then((relatedItems) =&gt; { records.forEach((item) =&gt; { let attached = [] let itemKeys = utils.get(item, def.localKeys) || [] itemKeys = utils.isArray(itemKeys) ? itemKeys : Object.keys(itemKeys) relatedItems.forEach((relatedItem) =&gt; { if (itemKeys &amp;&amp; itemKeys.indexOf(relatedItem[relatedMapper.idAttribute]) !== -1) { attached.push(relatedItem) } }) def.setLocalField(item, attached) }) return relatedItems }) } }, loadHasManyForeignKeys (mapper, def, records, __opts) { const relatedMapper = def.getRelation() const idAttribute = mapper.idAttribute let record if (utils.isObject(records) &amp;&amp; !utils.isArray(records)) { record = records } if (record) { return this.findAll(def.getRelation(), { where: { [def.foreignKeys]: { 'contains': this.makeHasManyForeignKeys(mapper, def, record) } } }, __opts).then((relatedItems) =&gt; { def.setLocalField(record, relatedItems) }) } else { return this.findAll(relatedMapper, { where: { [def.foreignKeys]: { 'isectNotEmpty': records.map((record) =&gt; this.makeHasManyForeignKeys(mapper, def, record)) } } }, __opts).then((relatedItems) =&gt; { const foreignKeysField = def.foreignKeys records.forEach((record) =&gt; { const _relatedItems = [] const id = utils.get(record, idAttribute) relatedItems.forEach((relatedItem) =&gt; { const foreignKeys = utils.get(relatedItems, foreignKeysField) || [] if (foreignKeys.indexOf(id) !== -1) { _relatedItems.push(relatedItem) } }) def.setLocalField(record, _relatedItems) }) }) } }, /** * Load a hasOne relationship. * * Override with care. * * @name Adapter#loadHasOne * @method * @return {Promise} */ loadHasOne (mapper, def, records, __opts) { if (utils.isObject(records) &amp;&amp; !utils.isArray(records)) { records = [records] } return this.loadHasMany(mapper, def, records, __opts).then(() =&gt; { records.forEach((record) =&gt; { const relatedData = def.getLocalField(record) if (utils.isArray(relatedData) &amp;&amp; relatedData.length) { def.setLocalField(record, relatedData[0]) } }) }) }, /** * Return the foreignKey from the given record for the provided relationship. * * There may be reasons why you may want to override this method, like when * the id of the parent doesn't exactly match up to the key on the child. * * Override with care. * * @name Adapter#makeHasManyForeignKey * @method * @return {*} */ makeHasManyForeignKey (mapper, def, record) { return def.getForeignKey(record) }, /** * Return the localKeys from the given record for the provided relationship. * * Override with care. * * @name Adapter#makeHasManyLocalKeys * @method * @return {*} */ makeHasManyLocalKeys (mapper, def, record) { let localKeys = [] let itemKeys = utils.get(record, def.localKeys) || [] itemKeys = utils.isArray(itemKeys) ? itemKeys : Object.keys(itemKeys) localKeys = localKeys.concat(itemKeys) return unique(localKeys).filter((x) =&gt; x) }, /** * Return the foreignKeys from the given record for the provided relationship. * * Override with care. * * @name Adapter#makeHasManyForeignKeys * @method * @return {*} */ makeHasManyForeignKeys (mapper, def, record) { return utils.get(record, mapper.idAttribute) }, /** * Return the foreignKey from the given record for the provided relationship. * * Override with care. * * @name Adapter#makeBelongsToForeignKey * @method * @return {*} */ makeBelongsToForeignKey (mapper, def, record) { return def.getForeignKey(record) }, /** * Retrieve sum of the specified field of the records that match the selection * query. Called by `Mapper#sum`. * * @name Adapter#sum * @method * @param {Object} mapper The mapper. * @param {string} field By to sum. * @param {Object} [query] Selection query. * @param {Object} [query.where] Filtering criteria. * @param {string|Array} [query.orderBy] Sorting criteria. * @param {string|Array} [query.sort] Same as `query.sort`. * @param {number} [query.limit] Limit results. * @param {number} [query.skip] Offset results. * @param {number} [query.offset] Same as `query.skip`. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ sum (mapper, field, query, opts) { let op if (!utils.isString(field)) { throw new Error('field must be a string!') } query || (query = {}) opts || (opts = {}) // beforeSum lifecycle hook op = opts.op = 'beforeSum' return utils.resolve(this[op](mapper, field, query, opts)) .then(() =&gt; { // Allow for re-assignment from lifecycle hook op = opts.op = 'sum' this.dbg(op, mapper, field, query, opts) return utils.resolve(this._sum(mapper, field, query, opts)) }) .then((results) =&gt; { let [data, result] = results result || (result = {}) let response = new Response(data, result, op) response = this.respond(response, opts) // afterSum lifecycle hook op = opts.op = 'afterSum' return utils.resolve(this[op](mapper, field, query, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * @name Adapter#respond * @method * @param {Object} response Response object. * @param {Object} opts Configuration options. * return {Object} If `opts.raw == true` then return `response`, else return * `response.data`. */ respond (response, opts) { return this.getOpt('raw', opts) ? response : response.data }, /** * Apply the given update to the record with the specified primary key. Called * by `Mapper#update`. * * @name Adapter#update * @method * @param {Object} mapper The mapper. * @param {(string|number)} id The primary key of the record to be updated. * @param {Object} props The update to apply to the record. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ update (mapper, id, props, opts) { props || (props = {}) opts || (opts = {}) let op // beforeUpdate lifecycle hook op = opts.op = 'beforeUpdate' return utils.resolve(this[op](mapper, id, props, opts)) .then((_props) =&gt; { // Allow for re-assignment from lifecycle hook props = _props === undefined ? props : _props props = withoutRelations(mapper, props, opts) op = opts.op = 'update' this.dbg(op, mapper, id, props, opts) return utils.resolve(this._update(mapper, id, props, opts)) }) .then((results) =&gt; { let [data, result] = results result || (result = {}) let response = new Response(data, result, 'update') response.updated = data ? 1 : 0 response = this.respond(response, opts) // afterUpdate lifecycle hook op = opts.op = 'afterUpdate' return utils.resolve(this[op](mapper, id, props, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Apply the given update to all records that match the selection query. * Called by `Mapper#updateAll`. * * @name Adapter#updateAll * @method * @param {Object} mapper The mapper. * @param {Object} props The update to apply to the selected records. * @param {Object} [query] Selection query. * @param {Object} [query.where] Filtering criteria. * @param {string|Array} [query.orderBy] Sorting criteria. * @param {string|Array} [query.sort] Same as `query.sort`. * @param {number} [query.limit] Limit results. * @param {number} [query.skip] Offset results. * @param {number} [query.offset] Same as `query.skip`. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ updateAll (mapper, props, query, opts) { props || (props = {}) query || (query = {}) opts || (opts = {}) let op // beforeUpdateAll lifecycle hook op = opts.op = 'beforeUpdateAll' return utils.resolve(this[op](mapper, props, query, opts)) .then((_props) =&gt; { // Allow for re-assignment from lifecycle hook props = _props === undefined ? props : _props props = withoutRelations(mapper, props, opts) op = opts.op = 'updateAll' this.dbg(op, mapper, props, query, opts) return utils.resolve(this._updateAll(mapper, props, query, opts)) }) .then((results) =&gt; { let [data, result] = results data || (data = []) result || (result = {}) let response = new Response(data, result, 'updateAll') response.updated = data.length response = this.respond(response, opts) // afterUpdateAll lifecycle hook op = opts.op = 'afterUpdateAll' return utils.resolve(this[op](mapper, props, query, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) }, /** * Update the given records in a single batch. Called by `Mapper#updateMany`. * * @name Adapter#updateMany * @method * @param {Object} mapper The mapper. * @param {Object[]} records The records to update. * @param {Object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ updateMany (mapper, records, opts) { records || (records = []) opts || (opts = {}) let op const idAttribute = mapper.idAttribute records = records.filter((record) =&gt; utils.get(record, idAttribute)) // beforeUpdateMany lifecycle hook op = opts.op = 'beforeUpdateMany' return utils.resolve(this[op](mapper, records, opts)) .then((_records) =&gt; { // Allow for re-assignment from lifecycle hook records = _records === undefined ? records : _records records = records.map((record) =&gt; withoutRelations(mapper, record, opts)) op = opts.op = 'updateMany' this.dbg(op, mapper, records, opts) return utils.resolve(this._updateMany(mapper, records, opts)) }) .then((results) =&gt; { let [data, result] = results data || (data = []) result || (result = {}) let response = new Response(data, result, 'updateMany') response.updated = data.length response = this.respond(response, opts) // afterUpdateMany lifecycle hook op = opts.op = 'afterUpdateMany' return utils.resolve(this[op](mapper, records, opts, response)) .then((_response) =&gt; _response === undefined ? response : _response) }) } }) /** * Create a subclass of this Adapter: * * @example &lt;caption&gt;Adapter.extend&lt;/caption&gt; * // Normally you would do: import {Adapter} from 'js-data' * const JSData = require('js-data@3.0.0-beta.10') * const {Adapter} = JSData * console.log('Using JSData v' + JSData.version.full) * * // Extend the class using ES2015 class syntax. * class CustomAdapterClass extends Adapter { * foo () { return 'bar' } * static beep () { return 'boop' } * } * const customAdapter = new CustomAdapterClass() * console.log(customAdapter.foo()) * console.log(CustomAdapterClass.beep()) * * // Extend the class using alternate method. * const OtherAdapterClass = Adapter.extend({ * foo () { return 'bar' } * }, { * beep () { return 'boop' } * }) * const otherAdapter = new OtherAdapterClass() * console.log(otherAdapter.foo()) * console.log(OtherAdapterClass.beep()) * * // Extend the class, providing a custom constructor. * function AnotherAdapterClass () { * Adapter.call(this) * this.created_at = new Date().getTime() * } * Adapter.extend({ * constructor: AnotherAdapterClass, * foo () { return 'bar' } * }, { * beep () { return 'boop' } * }) * const anotherAdapter = new AnotherAdapterClass() * console.log(anotherAdapter.created_at) * console.log(anotherAdapter.foo()) * console.log(AnotherAdapterClass.beep()) * * @method Adapter.extend * @param {Object} [props={}] Properties to add to the prototype of the * subclass. * @param {Object} [props.constructor] Provide a custom constructor function * to be used as the subclass itself. * @param {Object} [classProps={}] Static properties to add to the subclass. * @returns {Constructor} Subclass of this Adapter class. */  Search results Close api.js-data.io  js-data.io "},"src_index.js.html":{"id":"src_index.js.html","title":"Source: src/index.js","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Source: src/index.js import {MongoClient} from 'mongodb' import {ObjectID} from 'bson' import {utils} from 'js-data' import { Adapter, reserved } from 'js-data-adapter' import snakeCase from 'lodash.snakecase' const DEFAULTS = { /** * Convert ObjectIDs to strings when pulling records out of the database. * * @name MongoDBAdapter#translateId * @type {boolean} * @default true */ translateId: true, /** * Convert fields of record from database that are ObjectIDs to strings * * @name MongoDBAdapter#translateObjectIDs * @type {Boolean} * @default false */ translateObjectIDs: false, /** * MongoDB URI. * * @name MongoDBAdapter#uri * @type {string} * @default mongodb://localhost:27017 */ uri: 'mongodb://localhost:27017', /** * MongoDB Driver options * * @name MongoDBAdapter#mongoDriverOpts * @type {object} * @default { ignoreUndefined: true } */ mongoDriverOpts: { ignoreUndefined: true } } const COUNT_OPTS_DEFAULTS = {} const FIND_OPTS_DEFAULTS = {} const FIND_ONE_OPTS_DEFAULTS = {} const INSERT_OPTS_DEFAULTS = {} const INSERT_MANY_OPTS_DEFAULTS = {} const UPDATE_OPTS_DEFAULTS = {} const REMOVE_OPTS_DEFAULTS = {} /** * MongoDBAdapter class. * * @example * // Use Container instead of DataStore on the server * import {Container} from 'js-data' * import MongoDBAdapter from 'js-data-mongodb' * * // Create a store to hold your Mappers * const store = new Container({ * mapperDefaults: { * // MongoDB uses &quot;_id&quot; as the primary key * idAttribute: '_id' * } * }) * * // Create an instance of MongoDBAdapter with default settings * const adapter = new MongoDBAdapter() * * // Mappers in &quot;store&quot; will use the MongoDB adapter by default * store.registerAdapter('mongodb', adapter, { default: true }) * * // Create a Mapper that maps to a &quot;user&quot; collection * store.defineMapper('user') * * @class MongoDBAdapter * @extends Adapter * @param {object} [opts] Configuration options. * @param {boolean} [opts.debug=false] See {@link Adapter#debug}. * @param {object} [opts.countOpts] See {@link MongoDBAdapter#countOpts}. * @param {object} [opts.findOpts] See {@link MongoDBAdapter#findOpts}. * @param {object} [opts.findOneOpts] See {@link MongoDBAdapter#findOneOpts}. * @param {object} [opts.insertOpts] See {@link MongoDBAdapter#insertOpts}. * @param {object} [opts.insertManyOpts] See {@link MongoDBAdapter#insertManyOpts}. * @param {boolean} [opts.raw=false] See {@link Adapter#raw}. * @param {object} [opts.removeOpts] See {@link MongoDBAdapter#removeOpts}. * @param {boolean} [opts.translateId=true] See {@link MongoDBAdapter#translateId}. * @param {boolean} [opts.translateObjectIDs=false] See {@link MongoDBAdapter#translateObjectIDs}. * @param {object} [opts.updateOpts] See {@link MongoDBAdapter#updateOpts}. * @param {string} [opts.uri=&quot;mongodb://localhost:27017&quot;] See {@link MongoDBAdapter#uri}. */ export function MongoDBAdapter (opts) { utils.classCallCheck(this, MongoDBAdapter) opts || (opts = {}) if (utils.isString(opts)) { opts = { uri: opts } } utils.fillIn(opts, DEFAULTS) // Setup non-enumerable properties Object.defineProperties(this, { /** * A Promise that resolves to a reference to the MongoDB client being used by * this adapter. * * @name MongoDBAdapter#client * @type {Promise} */ client: { writable: true, value: undefined }, _db: { writable: true, value: undefined } }) Adapter.call(this, opts) /** * Default options to pass to collection#count. * * @name MongoDBAdapter#countOpts * @type {object} * @default {} */ this.countOpts || (this.countOpts = {}) utils.fillIn(this.countOpts, COUNT_OPTS_DEFAULTS) /** * Default options to pass to collection#find. * * @name MongoDBAdapter#findOpts * @type {object} * @default {} */ this.findOpts || (this.findOpts = {}) utils.fillIn(this.findOpts, FIND_OPTS_DEFAULTS) /** * Default options to pass to collection#findOne. * * @name MongoDBAdapter#findOneOpts * @type {object} * @default {} */ this.findOneOpts || (this.findOneOpts = {}) utils.fillIn(this.findOneOpts, FIND_ONE_OPTS_DEFAULTS) /** * Default options to pass to collection#insert. * * @name MongoDBAdapter#insertOpts * @type {object} * @default {} */ this.insertOpts || (this.insertOpts = {}) utils.fillIn(this.insertOpts, INSERT_OPTS_DEFAULTS) /** * Default options to pass to collection#insertMany. * * @name MongoDBAdapter#insertManyOpts * @type {object} * @default {} */ this.insertManyOpts || (this.insertManyOpts = {}) utils.fillIn(this.insertManyOpts, INSERT_MANY_OPTS_DEFAULTS) /** * Default options to pass to collection#update. * * @name MongoDBAdapter#updateOpts * @type {object} * @default {} */ this.updateOpts || (this.updateOpts = {}) utils.fillIn(this.updateOpts, UPDATE_OPTS_DEFAULTS) /** * Default options to pass to collection#destroy. * * @name MongoDBAdapter#removeOpts * @type {object} * @default {} */ this.removeOpts || (this.removeOpts = {}) utils.fillIn(this.removeOpts, REMOVE_OPTS_DEFAULTS) this.client = new utils.Promise((resolve, reject) =&gt; { MongoClient.connect(opts.uri, opts.mongoDriverOpts, (err, db) =&gt; { if (err) { return reject(err) } this._db = db resolve(db) }) }) } Adapter.extend({ constructor: MongoDBAdapter, _translateObjectIDs (r, opts) { opts || (opts = {}) if (this.getOpt('translateObjectIDs', opts)) { this._translateFieldObjectIDs(r) } else if (this.getOpt('translateId', opts)) { this._translateId(r) } return r }, /** * Translate ObjectIDs to strings. * * @method MongoDBAdapter#_translateId * @return {*} */ _translateId (r) { if (utils.isArray(r)) { r.forEach((_r) =&gt; { const __id = _r._id ? _r._id.toString() : _r._id _r._id = typeof __id === 'string' ? __id : _r._id }) } else if (utils.isObject(r)) { const __id = r._id ? r._id.toString() : r._id r._id = typeof __id === 'string' ? __id : r._id } return r }, _translateFieldObjectIDs (r) { const _checkFields = (r) =&gt; { for (let field in r) { if (r[field]._bsontype === 'ObjectID') { r[field] = typeof r[field].toString() === 'string' ? r[field].toString() : r[field] } } } if (utils.isArray(r)) { r.forEach((_r) =&gt; { _checkFields(_r) }) } else if (utils.isObject(r)) { _checkFields(r) } return r }, /** * Retrieve the number of records that match the selection query. * * @method MongoDBAdapter#count * @param {object} mapper The mapper. * @param {object} query Selection query. * @param {object} [opts] Configuration options. * @param {object} [opts.countOpts] Options to pass to collection#count. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {string[]} [opts.with=[]] Relations to eager load. * @return {Promise} */ /** * Retrieve the records that match the selection query. Internal method used * by Adapter#count. * * @method MongoDBAdapter#_count * @private * @param {object} mapper The mapper. * @param {object} query Selection query. * @param {object} [opts] Configuration options. * @return {Promise} */ _count (mapper, query, opts) { opts || (opts = {}) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const countOpts = this.getOpt('countOpts', opts) utils.fillIn(countOpts, this.getQueryOptions(mapper, query)) const mongoQuery = this.getQuery(mapper, query) client .collection(collectionId) .count(mongoQuery, countOpts, (err, count) =&gt; err ? failure(err) : success([count, {}])) }) }, /** * Create a new record. * * @method MongoDBAdapter#create * @param {object} mapper The mapper. * @param {object} props The record to be created. * @param {object} [opts] Configuration options. * @param {object} [opts.insertOpts] Options to pass to collection#insert. * @param {boolean} [opts.raw=false] Whether to return a more detailed * @return {Promise} */ /** * Create a new record. Internal method used by Adapter#create. * * @method MongoDBAdapter#_create * @private * @param {object} mapper The mapper. * @param {object} props The record to be created. * @param {object} [opts] Configuration options. * @return {Promise} */ _create (mapper, props, opts) { props || (props = {}) opts || (opts = {}) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const insertOpts = this.getOpt('insertOpts', opts) const collection = client.collection(collectionId) const handler = (err, cursor) =&gt; err ? failure(err) : success(cursor) props = utils.plainCopy(props) if (collection.insertOne) { collection .insertOne(props, insertOpts, handler) } else { collection .insert(props, insertOpts, handler) } }).then((cursor) =&gt; { let record let r = cursor.ops ? cursor.ops : cursor this._translateObjectIDs(r, opts) record = utils.isArray(r) ? r[0] : r cursor.connection = undefined return [record, cursor] }) }, /** * Create multiple records in a single batch. * * @method MongoDBAdapter#createMany * @param {object} mapper The mapper. * @param {object} props The records to be created. * @param {object} [opts] Configuration options. * @param {object} [opts.insertManyOpts] Options to pass to * collection#insertMany. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @return {Promise} */ /** * Create multiple records in a single batch. Internal method used by * Adapter#createMany. * * @method MongoDBAdapter#_createMany * @private * @param {object} mapper The mapper. * @param {object} props The records to be created. * @param {object} [opts] Configuration options. * @return {Promise} */ _createMany (mapper, props, opts) { props || (props = {}) opts || (opts = {}) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const insertManyOpts = this.getOpt('insertManyOpts', opts) props = utils.plainCopy(props) client.collection(collectionId) .insertMany(props, insertManyOpts, (err, cursor) =&gt; err ? failure(err) : success(cursor)) }).then((cursor) =&gt; { let records = [] let r = cursor.ops ? cursor.ops : cursor this._translateObjectIDs(r, opts) records = r cursor.connection = undefined return [records, cursor] }) }, /** * Destroy the record with the given primary key. * * @method MongoDBAdapter#destroy * @param {object} mapper The mapper. * @param {(string|number)} id Primary key of the record to destroy. * @param {object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {object} [opts.removeOpts] Options to pass to collection#remove. * @return {Promise} */ /** * Destroy the record with the given primary key. Internal method used by * Adapter#destroy. * * @method MongoDBAdapter#_destroy * @private * @param {object} mapper The mapper. * @param {(string|number)} id Primary key of the record to destroy. * @param {object} [opts] Configuration options. * @return {Promise} */ _destroy (mapper, id, opts) { opts || (opts = {}) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const removeOpts = this.getOpt('removeOpts', opts) const mongoQuery = { [mapper.idAttribute]: this.toObjectID(mapper, id) } const collection = client.collection(collectionId) const handler = (err, cursor) =&gt; err ? failure(err) : success(cursor) if (collection.deleteOne) { collection .deleteOne(mongoQuery, removeOpts, handler) } else { collection .remove(mongoQuery, removeOpts, handler) } }).then((cursor) =&gt; [undefined, cursor]) }, /** * Destroy the records that match the selection query. * * @method MongoDBAdapter#destroyAll * @param {object} mapper the mapper. * @param {object} [query] Selection query. * @param {object} [query.where] Filtering criteria. * @param {string|Array} [query.orderBy] Sorting criteria. * @param {string|Array} [query.sort] Same as `query.sort`. * @param {number} [query.limit] Limit results. * @param {number} [query.skip] Offset results. * @param {number} [query.offset] Same as `query.skip`. * @param {object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {object} [opts.removeOpts] Options to pass to collection#remove. * @return {Promise} */ /** * Destroy the records that match the selection query. Internal method used by * Adapter#destroyAll. * * @method MongoDBAdapter#_destroyAll * @private * @param {object} mapper the mapper. * @param {object} [query] Selection query. * @param {object} [opts] Configuration options. * @return {Promise} */ _destroyAll (mapper, query, opts) { query || (query = {}) opts || (opts = {}) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const removeOpts = this.getOpt('removeOpts', opts) utils.fillIn(removeOpts, this.getQueryOptions(mapper, query)) const mongoQuery = this.getQuery(mapper, query) const collection = client.collection(collectionId) const handler = (err, cursor) =&gt; err ? failure(err) : success(cursor) if (collection.deleteMany) { collection .deleteMany(mongoQuery, removeOpts, handler) } else { collection .remove(mongoQuery, removeOpts, handler) } }).then((cursor) =&gt; { cursor.connection = undefined return [undefined, cursor] }) }, /** * Retrieve the record with the given primary key. * * @method MongoDBAdapter#find * @param {object} mapper The mapper. * @param {(string|number)} id Primary key of the record to retrieve. * @param {object} [opts] Configuration options. * @param {string|string[]|object} [opts.fields] Select a subset of fields to be returned. * @param {object} [opts.findOneOpts] Options to pass to collection#findOne. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {string[]} [opts.with=[]] Relations to eager load. * @return {Promise} */ /** * Retrieve the record with the given primary key. Internal method used by * Adapter#find. * * @method MongoDBAdapter#_find * @private * @param {object} mapper The mapper. * @param {(string|number)} id Primary key of the record to retrieve. * @param {object} [opts] Configuration options. * @param {string|string[]|object} [opts.fields] Select a subset of fields to be returned. * @return {Promise} */ _find (mapper, id, opts) { opts || (opts = {}) opts.with || (opts.with = []) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const findOneOpts = this.getOpt('findOneOpts', opts) findOneOpts.fields = this._getFields(mapper, opts) const mongoQuery = { [mapper.idAttribute]: this.toObjectID(mapper, id) } client.collection(collectionId) .findOne(mongoQuery, findOneOpts, (err, record) =&gt; err ? failure(err) : success(record)) }).then((record) =&gt; { if (record) { this._translateObjectIDs(record, opts) } else { record = undefined } return [record, {}] }) }, /** * Retrieve the records that match the selection query. * * @method MongoDBAdapter#findAll * @param {object} mapper The mapper. * @param {object} query Selection query. * @param {object} [opts] Configuration options. * @param {string|string[]|object} [opts.fields] Select a subset of fields to be returned. * @param {object} [opts.findOpts] Options to pass to collection#find. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {string[]} [opts.with=[]] Relations to eager load. * @return {Promise} */ /** * Retrieve the records that match the selection query. Internal method used * by Adapter#findAll. * * @method MongoDBAdapter#_findAll * @private * @param {object} mapper The mapper. * @param {object} query Selection query. * @param {object} [opts] Configuration options. * @param {string|string[]|object} [opts.fields] Select a subset of fields to be returned. * @return {Promise} */ _findAll (mapper, query, opts) { opts || (opts = {}) return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const findOpts = this.getOpt('findOpts', opts) utils.fillIn(findOpts, this.getQueryOptions(mapper, query)) findOpts.fields = this._getFields(mapper, opts) const mongoQuery = this.getQuery(mapper, query) client.collection(collectionId) .find(mongoQuery, findOpts) .toArray((err, records) =&gt; err ? failure(err) : success(records)) }).then((records) =&gt; { this._translateObjectIDs(records, opts) return [records, {}] }) }, _getCollectionId (mapper, opts) { opts || (opts = {}) return opts.table || opts.collection || mapper.table || mapper.collection || snakeCase(mapper.name) }, _getFields (mapper, opts) { opts || (opts = {}) if (utils.isString(opts.fields)) { opts.fields = { [opts.fields]: 1 } } else if (utils.isArray(opts.fields)) { const fields = {} opts.fields.forEach((field) =&gt; { fields[field] = 1 }) return fields } return opts.fields }, _run (cb) { if (this._db) { // Use the cached db object return new utils.Promise((resolve, reject) =&gt; { cb(this._db, resolve, reject) }) } return this.getClient().then((client) =&gt; { return new utils.Promise((resolve, reject) =&gt; { cb(client, resolve, reject) }) }) }, /** * Apply the given update to the record with the specified primary key. * * @method MongoDBAdapter#update * @param {object} mapper The mapper. * @param {(string|number)} id The primary key of the record to be updated. * @param {object} props The update to apply to the record. * @param {object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {object} [opts.updateOpts] Options to pass to collection#update. * @return {Promise} */ /** * Apply the given update to the record with the specified primary key. * Internal method used by Adapter#update. * * @method MongoDBAdapter#_update * @private * @param {object} mapper The mapper. * @param {(string|number)} id The primary key of the record to be updated. * @param {object} props The update to apply to the record. * @param {object} [opts] Configuration options. * @return {Promise} */ _update (mapper, id, props, opts) { props || (props = {}) opts || (opts = {}) return this._find(mapper, id, { raw: false }) .then((result) =&gt; { if (!result[0]) { throw new Error('Not Found') } return this._run((client, success, failure) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const updateOpts = this.getOpt('updateOpts', opts) const mongoQuery = { [mapper.idAttribute]: this.toObjectID(mapper, id) } const collection = client.collection(collectionId) const handler = (err, cursor) =&gt; err ? failure(err) : success(cursor) if (collection.updateOne) { collection .updateOne(mongoQuery, { $set: props }, updateOpts, handler) } else { collection .update(mongoQuery, { $set: props }, updateOpts, handler) } }) }) .then((cursor) =&gt; { return this._find(mapper, id, { raw: false }) .then((result) =&gt; { cursor.connection = undefined return [result[0], cursor] }) }) }, /** * Apply the given update to all records that match the selection query. * * @method MongoDBAdapter#updateAll * @param {object} mapper The mapper. * @param {object} props The update to apply to the selected records. * @param {object} [query] Selection query. * @param {object} [opts] Configuration options. * @param {boolean} [opts.raw=false] Whether to return a more detailed * response object. * @param {object} [opts.updateOpts] Options to pass to collection#update. * @return {Promise} */ /** * Apply the given update to all records that match the selection query. * Internal method used by Adapter#updateAll. * * @method MongoDBAdapter#_updateAll * @private * @param {Object} mapper The mapper. * @param {Object} props The update to apply to the selected records. * @param {Object} [query] Selection query. * @param {Object} [opts] Configuration options. * @return {Promise} */ _updateAll (mapper, props, query, opts) { props || (props = {}) query || (query = {}) opts || (opts = {}) let ids return this._run((client, success, failure) =&gt; { return this._findAll(mapper, query, { raw: false }).then((result) =&gt; { const collectionId = this._getCollectionId(mapper, opts) const updateOpts = this.getOpt('updateOpts', opts) updateOpts.multi = true const queryOptions = this.getQueryOptions(mapper, query) queryOptions.$set = props ids = result[0].map((record) =&gt; this.toObjectID(mapper, record[mapper.idAttribute])) const mongoQuery = this.getQuery(mapper, query) const collection = client.collection(collectionId) const handler = (err, cursor) =&gt; err ? failure(err) : success(cursor) if (collection.updateMany) { collection .updateMany(mongoQuery, queryOptions, updateOpts, handler) } else { collection .update(mongoQuery, queryOptions, updateOpts, handler) } }) }).then((cursor) =&gt; { const query = { [mapper.idAttribute]: { 'in': ids } } return this._findAll(mapper, query, { raw: false }).then((result) =&gt; { cursor.connection = undefined return [result[0], cursor] }) }) }, /** * Return a Promise that resolves to a reference to the MongoDB client being * used by this adapter. * * Useful when you need to do anything custom with the MongoDB client library. * * @method MongoDBAdapter#getClient * @return {object} MongoDB client. */ getClient () { return this.client }, /** * Map filtering params in a selection query to MongoDB a filtering object. * * Handles the following: * * - where * - and bunch of filtering operators * * @method MongoDBAdapter#getQuery * @return {object} */ getQuery (mapper, query) { query = utils.plainCopy(query || {}) query.where || (query.where = {}) utils.forOwn(query, function (config, keyword) { if (reserved.indexOf(keyword) === -1) { if (utils.isObject(config)) { query.where[keyword] = config } else { query.where[keyword] = { '==': config } } delete query[keyword] } }) let mongoQuery = {} if (Object.keys(query.where).length !== 0) { utils.forOwn(query.where, function (criteria, field) { if (!utils.isObject(criteria)) { query.where[field] = { '==': criteria } } utils.forOwn(criteria, function (v, op) { if (op === '==' || op === '===' || op === 'contains') { mongoQuery[field] = v } else if (op === '!=' || op === '!==' || op === 'notContains') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$ne = v } else if (op === '&gt;') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$gt = v } else if (op === '&gt;=') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$gte = v } else if (op === '&lt;') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$lt = v } else if (op === '&lt;=') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$lte = v } else if (op === 'in') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$in = v } else if (op === 'notIn') { mongoQuery[field] = mongoQuery[field] || {} mongoQuery[field].$nin = v } else if (op === '|==' || op === '|===' || op === '|contains') { mongoQuery.$or = mongoQuery.$or || [] let orEqQuery = {} orEqQuery[field] = v mongoQuery.$or.push(orEqQuery) } else if (op === '|!=' || op === '|!==' || op === '|notContains') { mongoQuery.$or = mongoQuery.$or || [] let orNeQuery = {} orNeQuery[field] = { '$ne': v } mongoQuery.$or.push(orNeQuery) } else if (op === '|&gt;') { mongoQuery.$or = mongoQuery.$or || [] let orGtQuery = {} orGtQuery[field] = { '$gt': v } mongoQuery.$or.push(orGtQuery) } else if (op === '|&gt;=') { mongoQuery.$or = mongoQuery.$or || [] let orGteQuery = {} orGteQuery[field] = { '$gte': v } mongoQuery.$or.push(orGteQuery) } else if (op === '|&lt;') { mongoQuery.$or = mongoQuery.$or || [] let orLtQuery = {} orLtQuery[field] = { '$lt': v } mongoQuery.$or.push(orLtQuery) } else if (op === '|&lt;=') { mongoQuery.$or = mongoQuery.$or || [] let orLteQuery = {} orLteQuery[field] = { '$lte': v } mongoQuery.$or.push(orLteQuery) } else if (op === '|in') { mongoQuery.$or = mongoQuery.$or || [] let orInQuery = {} orInQuery[field] = { '$in': v } mongoQuery.$or.push(orInQuery) } else if (op === '|notIn') { mongoQuery.$or = mongoQuery.$or || [] let orNinQuery = {} orNinQuery[field] = { '$nin': v } mongoQuery.$or.push(orNinQuery) } }) }) } return mongoQuery }, /** * Map non-filtering params in a selection query to MongoDB query options. * * Handles the following: * * - limit * - skip/offset * - orderBy/sort * * @method MongoDBAdapter#getQueryOptions * @return {object} */ getQueryOptions (mapper, query) { query = utils.plainCopy(query || {}) query.orderBy = query.orderBy || query.sort query.skip = query.skip || query.offset let queryOptions = {} if (query.orderBy) { if (utils.isString(query.orderBy)) { query.orderBy = [ [query.orderBy, 'asc'] ] } for (var i = 0; i &lt; query.orderBy.length; i++) { if (utils.isString(query.orderBy[i])) { query.orderBy[i] = [query.orderBy[i], 'asc'] } } queryOptions.sort = query.orderBy } if (query.skip) { queryOptions.skip = +query.skip } if (query.limit) { queryOptions.limit = +query.limit } return queryOptions }, /** * Turn an _id into an ObjectID if it isn't already an ObjectID. * * @method MongoDBAdapter#toObjectID * @return {*} */ toObjectID (mapper, id) { if (id !== undefined &amp;&amp; mapper.idAttribute === '_id' &amp;&amp; typeof id === 'string' &amp;&amp; ObjectID.isValid(id) &amp;&amp; !(id instanceof ObjectID)) { return new ObjectID(id) } return id }, /** * Return the foreignKey from the given record for the provided relationship. * * @method MongoDBAdapter#makeBelongsToForeignKey * @return {*} */ makeBelongsToForeignKey (mapper, def, record) { return this.toObjectID(def.getRelation(), Adapter.prototype.makeBelongsToForeignKey.call(this, mapper, def, record)) }, /** * Return the localKeys from the given record for the provided relationship. * * Override with care. * * @method MongoDBAdapter#makeHasManyLocalKeys * @return {*} */ makeHasManyLocalKeys (mapper, def, record) { const relatedMapper = def.getRelation() const localKeys = Adapter.prototype.makeHasManyLocalKeys.call(this, mapper, def, record) return localKeys.map((key) =&gt; this.toObjectID(relatedMapper, key)) }, /** * Not supported. * * @method MongoDBAdapter#updateMany */ updateMany () { throw new Error('not supported!') } }) /** * Details of the current version of the `js-data-mongodb` module. * * @example * import {version} from 'js-data-mongodb' * console.log(version.full) * * @name module:js-data-mongodb.version * @type {object} * @property {string} version.full The full semver value. * @property {number} version.major The major version number. * @property {number} version.minor The minor version number. * @property {number} version.patch The patch version number. * @property {(string|boolean)} version.alpha The alpha version value, * otherwise `false` if the current version is not alpha. * @property {(string|boolean)} version.beta The beta version value, * otherwise `false` if the current version is not beta. */ export const version = '&lt;%= version %&gt;' /** * {@link MongoDBAdapter} class. * * @example * import {MongoDBAdapter} from 'js-data-mongodb' * const adapter = new MongoDBAdapter() * * @name module:js-data-mongodb.MongoDBAdapter * @see MongoDBAdapter * @type {Constructor} */ /** * Registered as `js-data-mongodb` in NPM. * * @example &lt;caption&gt;Install from NPM&lt;/caption&gt; * npm i --save js-data-mongodb@rc js-data@rc mongodb bson * * @example &lt;caption&gt;Load via CommonJS&lt;/caption&gt; * var MongoDBAdapter = require('js-data-mongodb').MongoDBAdapter * var adapter = new MongoDBAdapter() * * @example &lt;caption&gt;Load via ES2015 Modules&lt;/caption&gt; * import {MongoDBAdapter} from 'js-data-mongodb' * const adapter = new MongoDBAdapter() * * @module js-data-mongodb */ /** * Create a subclass of this MongoDBAdapter: * @example &lt;caption&gt;MongoDBAdapter.extend&lt;/caption&gt; * // Normally you would do: import { MongoDBAdapter } from 'js-data-mongodb' * const JSDataMongoDB = require('js-data-mongodb') * const { MongoDBAdapter } = JSDataMongoDB * console.log('Using JSDataMongoDB v' + JSDataMongoDB.version.full) * * // Extend the class using ES2015 class syntax. * class CustomMongoDBAdapterClass extends MongoDBAdapter { * foo () { return 'bar' } * static beep () { return 'boop' } * } * const customMongoDBAdapter = new CustomMongoDBAdapterClass() * console.log(customMongoDBAdapter.foo()) * console.log(CustomMongoDBAdapterClass.beep()) * * // Extend the class using alternate method. * const OtherMongoDBAdapterClass = MongoDBAdapter.extend({ * foo () { return 'bar' } * }, { * beep () { return 'boop' } * }) * const otherMongoDBAdapter = new OtherMongoDBAdapterClass() * console.log(otherMongoDBAdapter.foo()) * console.log(OtherMongoDBAdapterClass.beep()) * * // Extend the class, providing a custom constructor. * function AnotherMongoDBAdapterClass () { * MongoDBAdapter.call(this) * this.created_at = new Date().getTime() * } * MongoDBAdapter.extend({ * constructor: AnotherMongoDBAdapterClass, * foo () { return 'bar' } * }, { * beep () { return 'boop' } * }) * const anotherMongoDBAdapter = new AnotherMongoDBAdapterClass() * console.log(anotherMongoDBAdapter.created_at) * console.log(anotherMongoDBAdapter.foo()) * console.log(AnotherMongoDBAdapterClass.beep()) * * @method MongoDBAdapter.extend * @param {object} [props={}] Properties to add to the prototype of the * subclass. * @param {object} [props.constructor] Provide a custom constructor function * to be used as the subclass itself. * @param {object} [classProps={}] Static properties to add to the subclass. * @returns {Constructor} Subclass of this MongoDBAdapter class. * @since 3.0.0 */  Search results Close api.js-data.io  js-data.io "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Modules Details Classes Adapter MongoDBAdapter Response  Search results Close api.js-data.io  js-data.io "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Classes Details Classes Adapter MongoDBAdapter Response  Search results Close api.js-data.io  js-data.io "},"index.html":{"id":"index.html","title":"Index","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse js-data-mongodb 1.0.0 js-data-mongodb A MongoDB adapter for the JSData Node.js ORM. Installationnpm install --save js-data js-data-mongodb bson mongodbUsageimport { MongoDBAdapter } from 'js-data-mongodb'; // Create an instance of MongoDBAdapter const adapter = new MongoDBAdapter({ uri: 'mongodb://localhost:27017' }); // Other JSData setup hidden // Register the adapter instance store.registerAdapter('mongodb', adapter, { default: true });JSData + MongoDB TutorialStart with the JSData + MongoDB tutorial or checkout the API Reference Documentation. Need help?Please post a question on Stack Overflow. This is the preferred method. You can also chat with folks on the Slack Channel. If you end up getting your question answered, please still consider consider posting your question to Stack Overflow (then possibly answering it yourself). Thanks! Want to contribute?Awesome! You can get started over at the Contributing guide. Thank you! LicenseThe MIT License (MIT) Copyright (c) 2014-2017 js-data-mongodb project authors  Search results Close api.js-data.io  js-data.io "},"Adapter.html":{"id":"Adapter.html","title":"Class: Adapter","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Class: Adapter Adapter &lt;abstract&gt; new Adapter(opts) Abstract class meant to be extended by adapters. Method parameters: Name Type Argument Description opts Object &lt;optional&gt; Configuration opts. Properties Name Type Argument Default Description debug Boolean &lt;optional&gt; false Whether to log debugging information. raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Details Source node_modules/js-data-adapter/src/index.js, line 93 Extends This class extends the Component class. Members debug Whether to log debugging information. Details Type Default value Source Boolean false node_modules/js-data-adapter/src/index.js, line 74 raw Whether to return a more detailed response object. Details Type Default value Source Boolean false node_modules/js-data-adapter/src/index.js, line 83 Methods &lt;static&gt; extend(props, classProps) Create a subclass of this Adapter: Method parameters: Name Type Argument Default Description props Object &lt;optional&gt; {} Properties to add to the prototype of the subclass. Properties Name Type Argument Description constructor Object &lt;optional&gt; Provide a custom constructor function to be used as the subclass itself. classProps Object &lt;optional&gt; {} Static properties to add to the subclass. Return value: Type Description Constructor Subclass of this Adapter class. Details Source node_modules/js-data-adapter/src/index.js, line 1396 Example Try it out // Normally you would do: import {Adapter} from 'js-data' const JSData = require('js-data@3.0.0-beta.10') const {Adapter} = JSData console.log('Using JSData v' + JSData.version.full) // Extend the class using ES2015 class syntax. class CustomAdapterClass extends Adapter { foo () { return 'bar' } static beep () { return 'boop' } } const customAdapter = new CustomAdapterClass() console.log(customAdapter.foo()) console.log(CustomAdapterClass.beep()) // Extend the class using alternate method. const OtherAdapterClass = Adapter.extend({ foo () { return 'bar' } }, { beep () { return 'boop' } }) const otherAdapter = new OtherAdapterClass() console.log(otherAdapter.foo()) console.log(OtherAdapterClass.beep()) // Extend the class, providing a custom constructor. function AnotherAdapterClass () { Adapter.call(this) this.created_at = new Date().getTime() } Adapter.extend({ constructor: AnotherAdapterClass, foo () { return 'bar' } }, { beep () { return 'boop' } }) const anotherAdapter = new AnotherAdapterClass() console.log(anotherAdapter.created_at) console.log(anotherAdapter.foo()) console.log(AnotherAdapterClass.beep()) // Normally you would do: import {Adapter} from 'js-data' const JSData = require('js-data@3.0.0-beta.10') const {Adapter} = JSData console.log('Using JSData v' + JSData.version.full) // Extend the class using ES2015 class syntax. class CustomAdapterClass extends Adapter { foo () { return 'bar' } static beep () { return 'boop' } } const customAdapter = new CustomAdapterClass() console.log(customAdapter.foo()) console.log(CustomAdapterClass.beep()) // Extend the class using alternate method. const OtherAdapterClass = Adapter.extend({ foo () { return 'bar' } }, { beep () { return 'boop' } }) const otherAdapter = new OtherAdapterClass() console.log(otherAdapter.foo()) console.log(OtherAdapterClass.beep()) // Extend the class, providing a custom constructor. function AnotherAdapterClass () { Adapter.call(this) this.created_at = new Date().getTime() } Adapter.extend({ constructor: AnotherAdapterClass, foo () { return 'bar' } }, { beep () { return 'boop' } }) const anotherAdapter = new AnotherAdapterClass() console.log(anotherAdapter.created_at) console.log(anotherAdapter.foo()) console.log(AnotherAdapterClass.beep()) afterCount(mapper, props, opts, response) Lifecycle method method called by count. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes count to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the count. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by count. Method parameters: Name Type Description mapper Object The mapper argument passed to count. props Object The props argument passed to count. opts Object The opts argument passed to count. response Object | Response Count or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 115 Properties: Name Type Description opts.op String afterCount afterCreate(mapper, props, opts, response) Lifecycle method method called by createMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes createMany to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the created records. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by createMany. Method parameters: Name Type Description mapper Object The mapper argument passed to createMany. props Array.&lt;Object&gt; The props argument passed to createMany. opts Object The opts argument passed to createMany. response Array.&lt;Object&gt; | Response Created records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 161 Properties: Name Type Description opts.op String afterCreateMany afterCreate(mapper, props, opts, response) Lifecycle method method called by create. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes create to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the created record. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by create. Method parameters: Name Type Description mapper Object The mapper argument passed to create. props Object The props argument passed to create. opts Object The opts argument passed to create. response Object | Response Created record or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 138 Properties: Name Type Description opts.op String afterCreate afterDestroy(mapper, id, opts, response) Lifecycle method method called by destroy. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroy to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be undefined. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroy. Method parameters: Name Type Description mapper Object The mapper argument passed to destroy. id String | Number The id argument passed to destroy. opts Object The opts argument passed to destroy. response undefined | Response undefined or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 184 Properties: Name Type Description opts.op String afterDestroy afterDestroyAll(mapper, query, opts, response) Lifecycle method method called by destroyAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroyAll to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be undefined. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroyAll. Method parameters: Name Type Description mapper Object The mapper argument passed to destroyAll. query Object The query argument passed to destroyAll. opts Object The opts argument passed to destroyAll. response undefined | Response undefined or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 207 Properties: Name Type Description opts.op String afterDestroyAll afterFind(mapper, id, opts, response) Lifecycle method method called by find. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes find to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the found record, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by find. Method parameters: Name Type Description mapper Object The mapper argument passed to find. id String | Number The id argument passed to find. opts Object The opts argument passed to find. response Object | Response The found record or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 230 Properties: Name Type Description opts.op String afterFind afterFindAll(mapper, query, opts, response) Lifecycle method method called by findAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes findAll to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the found records, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by findAll. Method parameters: Name Type Description mapper Object The mapper argument passed to findAll. query Object The query argument passed to findAll. opts Object The opts argument passed to findAll. response Array.&lt;Object&gt; | Response The found records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 253 Properties: Name Type Description opts.op String afterFindAll afterSum(mapper, field, query, opts, response) Lifecycle method method called by sum. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes sum to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the sum. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by sum. Method parameters: Name Type Description mapper Object The mapper argument passed to sum. field String The field argument passed to sum. query Object The query argument passed to sum. opts Object The opts argument passed to sum. response Object | Response Count or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 276 Properties: Name Type Description opts.op String afterSum afterUpdate(mapper, id, props, opts, response) Lifecycle method method called by update. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes update to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the updated record. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by update. Method parameters: Name Type Description mapper Object The mapper argument passed to update. id String | Number The id argument passed to update. props Object The props argument passed to update. opts Object The opts argument passed to update. response Object | Response The updated record or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 300 Properties: Name Type Description opts.op String afterUpdate afterUpdateAll(mapper, props, query, opts, response) Lifecycle method method called by updateAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateAll to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the updated records, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateAll. Method parameters: Name Type Description mapper Object The mapper argument passed to updateAll. props Object The props argument passed to updateAll. query Object The query argument passed to updateAll. opts Object The opts argument passed to updateAll. response Array.&lt;Object&gt; | Response The updated records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 324 Properties: Name Type Description opts.op String afterUpdateAll afterUpdateMany(mapper, records, opts, response) Lifecycle method method called by updateMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateMany to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the updated records, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateMany. Method parameters: Name Type Description mapper Object The mapper argument passed to updateMany. records Array.&lt;Object&gt; The records argument passed to updateMany. opts Object The opts argument passed to updateMany. response Array.&lt;Object&gt; | Response The updated records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 348 Properties: Name Type Description opts.op String afterUpdateMany beforeCount(mapper, query, opts) Lifecycle method method called by count. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes count to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by count. Method parameters: Name Type Description mapper Object The mapper argument passed to count. query Object The query argument passed to count. opts Object The opts argument passed to count. Details Source node_modules/js-data-adapter/src/index.js, line 371 Properties: Name Type Description opts.op String beforeCount beforeCreate(mapper, props, opts) Lifecycle method method called by create. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes create to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by create. Method parameters: Name Type Description mapper Object The mapper argument passed to create. props Object The props argument passed to create. opts Object The opts argument passed to create. Details Source node_modules/js-data-adapter/src/index.js, line 389 Properties: Name Type Description opts.op String beforeCreate beforeCreateMany(mapper, props, opts) Lifecycle method method called by createMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes createMany to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by createMany. Method parameters: Name Type Description mapper Object The mapper argument passed to createMany. props Array.&lt;Object&gt; The props argument passed to createMany. opts Object The opts argument passed to createMany. Details Source node_modules/js-data-adapter/src/index.js, line 409 Properties: Name Type Description opts.op String beforeCreateMany beforeDestroy(mapper, id, opts) Lifecycle method method called by destroy. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroy to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroy. Method parameters: Name Type Description mapper Object The mapper argument passed to destroy. id String | Number The id argument passed to destroy. opts Object The opts argument passed to destroy. Details Source node_modules/js-data-adapter/src/index.js, line 429 Properties: Name Type Description opts.op String beforeDestroy beforeDestroyAll(mapper, query, opts) Lifecycle method method called by destroyAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroyAll to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroyAll. Method parameters: Name Type Description mapper Object The mapper argument passed to destroyAll. query Object The query argument passed to destroyAll. opts Object The opts argument passed to destroyAll. Details Source node_modules/js-data-adapter/src/index.js, line 447 Properties: Name Type Description opts.op String beforeDestroyAll beforeFind(mapper, id, opts) Lifecycle method method called by find. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes find to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by find. Method parameters: Name Type Description mapper Object The mapper argument passed to find. id String | Number The id argument passed to find. opts Object The opts argument passed to find. Details Source node_modules/js-data-adapter/src/index.js, line 465 Properties: Name Type Description opts.op String beforeFind beforeFindAll(mapper, query, opts) Lifecycle method method called by findAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes findAll to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by findAll. Method parameters: Name Type Description mapper Object The mapper argument passed to findAll. query Object The query argument passed to findAll. opts Object The opts argument passed to findAll. Details Source node_modules/js-data-adapter/src/index.js, line 483 Properties: Name Type Description opts.op String beforeFindAll beforeSum(mapper, query, opts) Lifecycle method method called by sum. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes sum to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by sum. Method parameters: Name Type Description mapper Object The mapper argument passed to sum. query Object The query argument passed to sum. opts Object The opts argument passed to sum. Details Source node_modules/js-data-adapter/src/index.js, line 501 Properties: Name Type Description opts.op String beforeSum beforeUpdate(mapper, id, props, opts) Lifecycle method method called by update. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes update to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by update. Method parameters: Name Type Description mapper Object The mapper argument passed to update. id String | Number The id argument passed to update. props Object The props argument passed to update. opts Object The opts argument passed to update. Details Source node_modules/js-data-adapter/src/index.js, line 519 Properties: Name Type Description opts.op String beforeUpdate beforeUpdateAll(mapper, props, query, opts) Lifecycle method method called by updateAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateAll to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateAll. Method parameters: Name Type Description mapper Object The mapper argument passed to updateAll. props Object The props argument passed to updateAll. query Object The query argument passed to updateAll. opts Object The opts argument passed to updateAll. Details Source node_modules/js-data-adapter/src/index.js, line 540 Properties: Name Type Description opts.op String beforeUpdateAll beforeUpdateMany(mapper, props, opts) Lifecycle method method called by updateMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateMany to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateMany. Method parameters: Name Type Description mapper Object The mapper argument passed to updateMany. props Array.&lt;Object&gt; The props argument passed to updateMany. opts Object The opts argument passed to updateMany. Details Source node_modules/js-data-adapter/src/index.js, line 561 Properties: Name Type Description opts.op String beforeUpdateMany count(mapper, query, opts) Retrieve the number of records that match the selection query. Called by Mapper#count. Method parameters: Name Type Argument Description mapper Object The mapper. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 581 create(mapper, props, opts) Create a new record. Called by Mapper#create. Method parameters: Name Type Argument Description mapper Object The mapper. props Object The record to be created. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 627 createMany(mapper, props, opts) Create multiple records in a single batch. Called by Mapper#createMany. Method parameters: Name Type Argument Description mapper Object The mapper. props Object The records to be created. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 669 destroy(mapper, id, opts) Destroy the record with the given primary key. Called by Mapper#destroy. Method parameters: Name Type Argument Description mapper Object The mapper. id String | Number Primary key of the record to destroy. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 712 destroyAll(mapper, query, opts) Destroy the records that match the selection query. Called by Mapper#destroyAll. Method parameters: Name Type Argument Description mapper Object the mapper. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 750 find(mapper, id, opts) Retrieve the record with the given primary key. Called by Mapper#find. Method parameters: Name Type Argument Description mapper Object The mapper. id String | Number Primary key of the record to retrieve. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. with Array.&lt;String&gt; &lt;optional&gt; [] Relations to eager load. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 835 findAll(mapper, query, opts) Retrieve the records that match the selection query. Method parameters: Name Type Argument Description mapper Object The mapper. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. with Array.&lt;String&gt; &lt;optional&gt; [] Relations to eager load. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 874 getOpt(opt, opts) Resolve the value of the specified option based on the given options and this adapter's settings. Override with care. Method parameters: Name Type Argument Description opt String The name of the option. opts Object &lt;optional&gt; Configuration options. Return value: Type Description * The value of the specified option. Details Source node_modules/js-data-adapter/src/index.js, line 960 loadBelongsTo() Load a belongsTo relationship. Override with care. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 795 loadHasMany() Load a hasMany relationship. Override with care. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 975 loadHasOne() Load a hasOne relationship. Override with care. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1109 makeBelongsToForeignKey() Return the foreignKey from the given record for the provided relationship. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1178 makeHasManyForeignKey() Return the foreignKey from the given record for the provided relationship. There may be reasons why you may want to override this method, like when the id of the parent doesn't exactly match up to the key on the child. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1132 makeHasManyForeignKeys() Return the foreignKeys from the given record for the provided relationship. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1165 makeHasManyLocalKeys() Return the localKeys from the given record for the provided relationship. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1148 respond(response, opts) Method parameters: Name Type Description response Object Response object. opts Object Configuration options. return {Object} If opts.raw == true then return response, else return response.data. Details Source node_modules/js-data-adapter/src/index.js, line 1241 sum(mapper, field, query, opts) Retrieve sum of the specified field of the records that match the selection query. Called by Mapper#sum. Method parameters: Name Type Argument Description mapper Object The mapper. field String By to sum. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1191 update(mapper, id, props, opts) Apply the given update to the record with the specified primary key. Called by Mapper#update. Method parameters: Name Type Argument Description mapper Object The mapper. id String | Number The primary key of the record to be updated. props Object The update to apply to the record. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1253 updateAll(mapper, props, query, opts) Apply the given update to all records that match the selection query. Called by Mapper#updateAll. Method parameters: Name Type Argument Description mapper Object The mapper. props Object The update to apply to the selected records. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1297 updateMany(mapper, records, opts) Update the given records in a single batch. Called by Mapper#updateMany. Method parameters: Name Type Argument Description mapper Object The mapper. records Array.&lt;Object&gt; The records to update. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1349  Search results Close api.js-data.io  js-data.io "},"module-js-data-mongodb.html":{"id":"module-js-data-mongodb.html","title":"Module: js-data-mongodb","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Module: js-data-mongodb Registered as js-data-mongodb in NPM. Details Source src/index.js, line 1022 Examples Try it out npm i --save js-data-mongodb@rc js-data@rc mongodb bson npm i --save js-data-mongodb@rc js-data@rc mongodb bson Try it out var MongoDBAdapter = require('js-data-mongodb').MongoDBAdapter var adapter = new MongoDBAdapter() var MongoDBAdapter = require('js-data-mongodb').MongoDBAdapter var adapter = new MongoDBAdapter() Try it out import {MongoDBAdapter} from 'js-data-mongodb' const adapter = new MongoDBAdapter() import {MongoDBAdapter} from 'js-data-mongodb' const adapter = new MongoDBAdapter() Classes MongoDBAdapter Members &lt;static&gt; MongoDBAdapter MongoDBAdapter class. Details Type Source See Constructor src/index.js, line 1010 MongoDBAdapter Example import {MongoDBAdapter} from 'js-data-mongodb' const adapter = new MongoDBAdapter() import {MongoDBAdapter} from 'js-data-mongodb' const adapter = new MongoDBAdapter() &lt;static&gt; version Details of the current version of the js-data-mongodb module. Details Type Source Object src/index.js, line 990 Properties: Name Type Description version.full String The full semver value. version.major Number The major version number. version.minor Number The minor version number. version.patch Number The patch version number. version.alpha String | Boolean The alpha version value, otherwise false if the current version is not alpha. version.beta String | Boolean The beta version value, otherwise false if the current version is not beta. Example import {version} from 'js-data-mongodb' console.log(version.full) import {version} from 'js-data-mongodb' console.log(version.full)  Search results Close api.js-data.io  js-data.io "},"module-js-data-mongodb-MongoDBAdapter.html":{"id":"module-js-data-mongodb-MongoDBAdapter.html","title":"Class: MongoDBAdapter","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Class: MongoDBAdapter js-data-mongodb~ MongoDBAdapter new MongoDBAdapter(opts) MongoDBAdapter class. Method parameters: Name Type Argument Description opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description debug Boolean &lt;optional&gt; false See Adapter#debug. countOpts Object &lt;optional&gt; See MongoDBAdapter#countOpts. findOpts Object &lt;optional&gt; See MongoDBAdapter#findOpts. findOneOpts Object &lt;optional&gt; See MongoDBAdapter#findOneOpts. insertOpts Object &lt;optional&gt; See MongoDBAdapter#insertOpts. insertManyOpts Object &lt;optional&gt; See MongoDBAdapter#insertManyOpts. raw Boolean &lt;optional&gt; false See Adapter#raw. removeOpts Object &lt;optional&gt; See MongoDBAdapter#removeOpts. translateId Boolean &lt;optional&gt; true See MongoDBAdapter#translateId. translateObjectIDs Boolean &lt;optional&gt; false See MongoDBAdapter#translateObjectIDs. updateOpts Object &lt;optional&gt; See MongoDBAdapter#updateOpts. uri String &lt;optional&gt; &quot;mongodb://localhost:27017&quot; See MongoDBAdapter#uri. Details Source src/index.js, line 57 Example // Use Container instead of DataStore on the server import {Container} from 'js-data' import MongoDBAdapter from 'js-data-mongodb' // Create a store to hold your Mappers const store = new Container({ mapperDefaults: { // MongoDB uses &quot;_id&quot; as the primary key idAttribute: '_id' } }) // Create an instance of MongoDBAdapter with default settings const adapter = new MongoDBAdapter() // Mappers in &quot;store&quot; will use the MongoDB adapter by default store.registerAdapter('mongodb', adapter, { default: true }) // Create a Mapper that maps to a &quot;user&quot; collection store.defineMapper('user') // Use Container instead of DataStore on the server import {Container} from 'js-data' import MongoDBAdapter from 'js-data-mongodb' // Create a store to hold your Mappers const store = new Container({ mapperDefaults: { // MongoDB uses &quot;_id&quot; as the primary key idAttribute: '_id' } }) // Create an instance of MongoDBAdapter with default settings const adapter = new MongoDBAdapter() // Mappers in &quot;store&quot; will use the MongoDB adapter by default store.registerAdapter('mongodb', adapter, { default: true }) // Create a Mapper that maps to a &quot;user&quot; collection store.defineMapper('user') Extends This class extends the Adapter class. Members debug Whether to log debugging information. Details Type Default value Source Boolean false node_modules/js-data-adapter/src/index.js, line 74 Inherited From: Adapter#debug raw Whether to return a more detailed response object. Details Type Default value Source Boolean false node_modules/js-data-adapter/src/index.js, line 83 Inherited From: Adapter#raw Methods afterCount(mapper, props, opts, response) Lifecycle method method called by count. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes count to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the count. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by count. Method parameters: Name Type Description mapper Object The mapper argument passed to count. props Object The props argument passed to count. opts Object The opts argument passed to count. response Object | Response Count or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 115 Properties: Name Type Description opts.op String afterCount Inherited From: Adapter#afterCount afterCreate(mapper, props, opts, response) Lifecycle method method called by create. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes create to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the created record. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by create. Method parameters: Name Type Description mapper Object The mapper argument passed to create. props Object The props argument passed to create. opts Object The opts argument passed to create. response Object | Response Created record or Response, depending on the value of opts.raw. Details Source Overrides node_modules/js-data-adapter/src/index.js, line 138 Adapter#afterCreate Properties: Name Type Description opts.op String afterCreate Inherited From: Adapter#afterCreate afterDestroy(mapper, id, opts, response) Lifecycle method method called by destroy. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroy to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be undefined. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroy. Method parameters: Name Type Description mapper Object The mapper argument passed to destroy. id String | Number The id argument passed to destroy. opts Object The opts argument passed to destroy. response undefined | Response undefined or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 184 Properties: Name Type Description opts.op String afterDestroy Inherited From: Adapter#afterDestroy afterDestroyAll(mapper, query, opts, response) Lifecycle method method called by destroyAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroyAll to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be undefined. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroyAll. Method parameters: Name Type Description mapper Object The mapper argument passed to destroyAll. query Object The query argument passed to destroyAll. opts Object The opts argument passed to destroyAll. response undefined | Response undefined or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 207 Properties: Name Type Description opts.op String afterDestroyAll Inherited From: Adapter#afterDestroyAll afterFind(mapper, id, opts, response) Lifecycle method method called by find. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes find to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the found record, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by find. Method parameters: Name Type Description mapper Object The mapper argument passed to find. id String | Number The id argument passed to find. opts Object The opts argument passed to find. response Object | Response The found record or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 230 Properties: Name Type Description opts.op String afterFind Inherited From: Adapter#afterFind afterFindAll(mapper, query, opts, response) Lifecycle method method called by findAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes findAll to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the found records, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by findAll. Method parameters: Name Type Description mapper Object The mapper argument passed to findAll. query Object The query argument passed to findAll. opts Object The opts argument passed to findAll. response Array.&lt;Object&gt; | Response The found records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 253 Properties: Name Type Description opts.op String afterFindAll Inherited From: Adapter#afterFindAll afterSum(mapper, field, query, opts, response) Lifecycle method method called by sum. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes sum to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the sum. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by sum. Method parameters: Name Type Description mapper Object The mapper argument passed to sum. field String The field argument passed to sum. query Object The query argument passed to sum. opts Object The opts argument passed to sum. response Object | Response Count or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 276 Properties: Name Type Description opts.op String afterSum Inherited From: Adapter#afterSum afterUpdate(mapper, id, props, opts, response) Lifecycle method method called by update. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes update to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the updated record. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by update. Method parameters: Name Type Description mapper Object The mapper argument passed to update. id String | Number The id argument passed to update. props Object The props argument passed to update. opts Object The opts argument passed to update. response Object | Response The updated record or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 300 Properties: Name Type Description opts.op String afterUpdate Inherited From: Adapter#afterUpdate afterUpdateAll(mapper, props, query, opts, response) Lifecycle method method called by updateAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateAll to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the updated records, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateAll. Method parameters: Name Type Description mapper Object The mapper argument passed to updateAll. props Object The props argument passed to updateAll. query Object The query argument passed to updateAll. opts Object The opts argument passed to updateAll. response Array.&lt;Object&gt; | Response The updated records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 324 Properties: Name Type Description opts.op String afterUpdateAll Inherited From: Adapter#afterUpdateAll afterUpdateMany(mapper, records, opts, response) Lifecycle method method called by updateMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateMany to wait for the Promise to resolve before continuing. If opts.raw is true then response will be a detailed response object, otherwise response will be the updated records, if any. response may be modified. You can also re-assign response to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateMany. Method parameters: Name Type Description mapper Object The mapper argument passed to updateMany. records Array.&lt;Object&gt; The records argument passed to updateMany. opts Object The opts argument passed to updateMany. response Array.&lt;Object&gt; | Response The updated records or Response, depending on the value of opts.raw. Details Source node_modules/js-data-adapter/src/index.js, line 348 Properties: Name Type Description opts.op String afterUpdateMany Inherited From: Adapter#afterUpdateMany beforeCount(mapper, query, opts) Lifecycle method method called by count. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes count to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by count. Method parameters: Name Type Description mapper Object The mapper argument passed to count. query Object The query argument passed to count. opts Object The opts argument passed to count. Details Source node_modules/js-data-adapter/src/index.js, line 371 Properties: Name Type Description opts.op String beforeCount Inherited From: Adapter#beforeCount beforeCreate(mapper, props, opts) Lifecycle method method called by create. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes create to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by create. Method parameters: Name Type Description mapper Object The mapper argument passed to create. props Object The props argument passed to create. opts Object The opts argument passed to create. Details Source node_modules/js-data-adapter/src/index.js, line 389 Properties: Name Type Description opts.op String beforeCreate Inherited From: Adapter#beforeCreate beforeCreateMany(mapper, props, opts) Lifecycle method method called by createMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes createMany to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by createMany. Method parameters: Name Type Description mapper Object The mapper argument passed to createMany. props Array.&lt;Object&gt; The props argument passed to createMany. opts Object The opts argument passed to createMany. Details Source node_modules/js-data-adapter/src/index.js, line 409 Properties: Name Type Description opts.op String beforeCreateMany Inherited From: Adapter#beforeCreateMany beforeDestroy(mapper, id, opts) Lifecycle method method called by destroy. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroy to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroy. Method parameters: Name Type Description mapper Object The mapper argument passed to destroy. id String | Number The id argument passed to destroy. opts Object The opts argument passed to destroy. Details Source node_modules/js-data-adapter/src/index.js, line 429 Properties: Name Type Description opts.op String beforeDestroy Inherited From: Adapter#beforeDestroy beforeDestroyAll(mapper, query, opts) Lifecycle method method called by destroyAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes destroyAll to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by destroyAll. Method parameters: Name Type Description mapper Object The mapper argument passed to destroyAll. query Object The query argument passed to destroyAll. opts Object The opts argument passed to destroyAll. Details Source node_modules/js-data-adapter/src/index.js, line 447 Properties: Name Type Description opts.op String beforeDestroyAll Inherited From: Adapter#beforeDestroyAll beforeFind(mapper, id, opts) Lifecycle method method called by find. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes find to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by find. Method parameters: Name Type Description mapper Object The mapper argument passed to find. id String | Number The id argument passed to find. opts Object The opts argument passed to find. Details Source node_modules/js-data-adapter/src/index.js, line 465 Properties: Name Type Description opts.op String beforeFind Inherited From: Adapter#beforeFind beforeFindAll(mapper, query, opts) Lifecycle method method called by findAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes findAll to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by findAll. Method parameters: Name Type Description mapper Object The mapper argument passed to findAll. query Object The query argument passed to findAll. opts Object The opts argument passed to findAll. Details Source node_modules/js-data-adapter/src/index.js, line 483 Properties: Name Type Description opts.op String beforeFindAll Inherited From: Adapter#beforeFindAll beforeSum(mapper, query, opts) Lifecycle method method called by sum. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes sum to wait for the Promise to resolve before continuing. A thrown error or rejected Promise will bubble up and reject the Promise returned by sum. Method parameters: Name Type Description mapper Object The mapper argument passed to sum. query Object The query argument passed to sum. opts Object The opts argument passed to sum. Details Source node_modules/js-data-adapter/src/index.js, line 501 Properties: Name Type Description opts.op String beforeSum Inherited From: Adapter#beforeSum beforeUpdate(mapper, id, props, opts) Lifecycle method method called by update. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes update to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by update. Method parameters: Name Type Description mapper Object The mapper argument passed to update. id String | Number The id argument passed to update. props Object The props argument passed to update. opts Object The opts argument passed to update. Details Source node_modules/js-data-adapter/src/index.js, line 519 Properties: Name Type Description opts.op String beforeUpdate Inherited From: Adapter#beforeUpdate beforeUpdateAll(mapper, props, query, opts) Lifecycle method method called by updateAll. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateAll to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateAll. Method parameters: Name Type Description mapper Object The mapper argument passed to updateAll. props Object The props argument passed to updateAll. query Object The query argument passed to updateAll. opts Object The opts argument passed to updateAll. Details Source node_modules/js-data-adapter/src/index.js, line 540 Properties: Name Type Description opts.op String beforeUpdateAll Inherited From: Adapter#beforeUpdateAll beforeUpdateMany(mapper, props, opts) Lifecycle method method called by updateMany. Override this method to add custom behavior for this lifecycle hook. Returning a Promise causes updateMany to wait for the Promise to resolve before continuing. props may be modified. You can also re-assign props to another value by returning a different value or a Promise that resolves to a different value. A thrown error or rejected Promise will bubble up and reject the Promise returned by updateMany. Method parameters: Name Type Description mapper Object The mapper argument passed to updateMany. props Array.&lt;Object&gt; The props argument passed to updateMany. opts Object The opts argument passed to updateMany. Details Source node_modules/js-data-adapter/src/index.js, line 561 Properties: Name Type Description opts.op String beforeUpdateMany Inherited From: Adapter#beforeUpdateMany count(mapper, query, opts) Retrieve the number of records that match the selection query. Called by Mapper#count. Method parameters: Name Type Argument Description mapper Object The mapper. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 581 Inherited From: Adapter#count create(mapper, props, opts) Create a new record. Called by Mapper#create. Method parameters: Name Type Argument Description mapper Object The mapper. props Object The record to be created. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 627 Inherited From: Adapter#create createMany(mapper, props, opts) Create multiple records in a single batch. Called by Mapper#createMany. Method parameters: Name Type Argument Description mapper Object The mapper. props Object The records to be created. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 669 Inherited From: Adapter#createMany destroy(mapper, id, opts) Destroy the record with the given primary key. Called by Mapper#destroy. Method parameters: Name Type Argument Description mapper Object The mapper. id String | Number Primary key of the record to destroy. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 712 Inherited From: Adapter#destroy destroyAll(mapper, query, opts) Destroy the records that match the selection query. Called by Mapper#destroyAll. Method parameters: Name Type Argument Description mapper Object the mapper. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 750 Inherited From: Adapter#destroyAll find(mapper, id, opts) Retrieve the record with the given primary key. Called by Mapper#find. Method parameters: Name Type Argument Description mapper Object The mapper. id String | Number Primary key of the record to retrieve. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. with Array.&lt;String&gt; &lt;optional&gt; [] Relations to eager load. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 835 Inherited From: Adapter#find findAll(mapper, query, opts) Retrieve the records that match the selection query. Method parameters: Name Type Argument Description mapper Object The mapper. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. with Array.&lt;String&gt; &lt;optional&gt; [] Relations to eager load. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 874 Inherited From: Adapter#findAll getOpt(opt, opts) Resolve the value of the specified option based on the given options and this adapter's settings. Override with care. Method parameters: Name Type Argument Description opt String The name of the option. opts Object &lt;optional&gt; Configuration options. Return value: Type Description * The value of the specified option. Details Source node_modules/js-data-adapter/src/index.js, line 960 Inherited From: Adapter#getOpt loadBelongsTo() Load a belongsTo relationship. Override with care. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 795 Inherited From: Adapter#loadBelongsTo loadHasMany() Load a hasMany relationship. Override with care. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 975 Inherited From: Adapter#loadHasMany loadHasOne() Load a hasOne relationship. Override with care. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1109 Inherited From: Adapter#loadHasOne makeBelongsToForeignKey() Return the foreignKey from the given record for the provided relationship. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1178 Inherited From: Adapter#makeBelongsToForeignKey makeHasManyForeignKey() Return the foreignKey from the given record for the provided relationship. There may be reasons why you may want to override this method, like when the id of the parent doesn't exactly match up to the key on the child. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1132 Inherited From: Adapter#makeHasManyForeignKey makeHasManyForeignKeys() Return the foreignKeys from the given record for the provided relationship. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1165 Inherited From: Adapter#makeHasManyForeignKeys makeHasManyLocalKeys() Return the localKeys from the given record for the provided relationship. Override with care. Return value: Type Description * Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1148 Inherited From: Adapter#makeHasManyLocalKeys respond(response, opts) Method parameters: Name Type Description response Object Response object. opts Object Configuration options. return {Object} If opts.raw == true then return response, else return response.data. Details Source node_modules/js-data-adapter/src/index.js, line 1241 Inherited From: Adapter#respond sum(mapper, field, query, opts) Retrieve sum of the specified field of the records that match the selection query. Called by Mapper#sum. Method parameters: Name Type Argument Description mapper Object The mapper. field String By to sum. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1191 Inherited From: Adapter#sum update(mapper, id, props, opts) Apply the given update to the record with the specified primary key. Called by Mapper#update. Method parameters: Name Type Argument Description mapper Object The mapper. id String | Number The primary key of the record to be updated. props Object The update to apply to the record. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1253 Inherited From: Adapter#update updateAll(mapper, props, query, opts) Apply the given update to all records that match the selection query. Called by Mapper#updateAll. Method parameters: Name Type Argument Description mapper Object The mapper. props Object The update to apply to the selected records. query Object &lt;optional&gt; Selection query. Properties Name Type Argument Description where Object &lt;optional&gt; Filtering criteria. orderBy String | Array &lt;optional&gt; Sorting criteria. sort String | Array &lt;optional&gt; Same as query.sort. limit Number &lt;optional&gt; Limit results. skip Number &lt;optional&gt; Offset results. offset Number &lt;optional&gt; Same as query.skip. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1297 Inherited From: Adapter#updateAll updateMany(mapper, records, opts) Update the given records in a single batch. Called by Mapper#updateMany. Method parameters: Name Type Argument Description mapper Object The mapper. records Array.&lt;Object&gt; The records to update. opts Object &lt;optional&gt; Configuration options. Properties Name Type Argument Default Description raw Boolean &lt;optional&gt; false Whether to return a more detailed response object. Return value: Type Description Promise Unspecified Details Source node_modules/js-data-adapter/src/index.js, line 1349 Inherited From: Adapter#updateMany  Search results Close api.js-data.io  js-data.io "},"Response.html":{"id":"Response.html","title":"Class: Response","body":" js-data-mongodb Modules js-data-mongodb Classes Adapterjs-data-mongodb~MongoDBAdapterResponse Class: Response Response new Response() Response object used when raw is true. May contain other fields in addition to data. Details Source node_modules/js-data-adapter/src/index.js, line 45 Members data Response data. Details Type Source * node_modules/js-data-adapter/src/index.js, line 54 op The operation for which the response was created. Details Type Source String node_modules/js-data-adapter/src/index.js, line 64  Search results Close api.js-data.io  js-data.io "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
