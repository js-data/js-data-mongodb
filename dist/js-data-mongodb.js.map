{"version":3,"file":"js-data-mongodb.js","sources":["../src/index.js"],"sourcesContent":["import {MongoClient} from 'mongodb'\nimport {ObjectID} from 'bson'\nimport {utils} from 'js-data'\nimport underscore from 'mout/string/underscore'\n\nconst {\n  addHiddenPropsToTarget,\n  fillIn,\n  forEachRelation,\n  forOwn,\n  get,\n  isArray,\n  isObject,\n  isString,\n  isUndefined,\n  plainCopy,\n  resolve\n} = utils\n\nconst reserved = [\n  'orderBy',\n  'sort',\n  'limit',\n  'offset',\n  'skip',\n  'where'\n]\n\nfunction unique (array) {\n  const seen = {}\n  const final = []\n  array.forEach(function (item) {\n    if (item in seen) {\n      return\n    }\n    final.push(item)\n    seen[item] = 0\n  })\n  return final\n}\n\nconst noop = function (...args) {\n  const self = this\n  const opts = args[args.length - 1]\n  self.dbg(opts.op, ...args)\n  return resolve()\n}\n\nconst noop2 = function (...args) {\n  const self = this\n  const opts = args[args.length - 2]\n  self.dbg(opts.op, ...args)\n  return resolve()\n}\n\nconst DEFAULTS = {\n  /**\n   * Whether to log debugging information.\n   *\n   * @name MongoDBAdapter#debug\n   * @type {boolean}\n   * @default false\n   */\n  debug: false,\n\n  /**\n   * Whether to return detailed result objects instead of just record data.\n   *\n   * @name MongoDBAdapter#raw\n   * @type {boolean}\n   * @default false\n   */\n  raw: false,\n\n  /**\n   * Convert ObjectIDs to strings when pulling records out of the database.\n   *\n   * @name MongoDBAdapter#translateId\n   * @type {boolean}\n   * @default true\n   */\n  translateId: true,\n\n  /**\n   * MongoDB URI.\n   *\n   * @name MongoDBAdapter#uri\n   * @type {string}\n   * @default mongodb://localhost:27017\n   */\n  uri: 'mongodb://localhost:27017'\n}\n\nconst FIND_OPTS_DEFAULTS = {}\nconst FIND_ONE_OPTS_DEFAULTS = {}\nconst INSERT_OPTS_DEFAULTS = {}\nconst INSERT_MANY_OPTS_DEFAULTS = {}\nconst UPDATE_OPTS_DEFAULTS = {}\nconst REMOVE_OPTS_DEFAULTS = {}\n\n/**\n * MongoDBAdapter class.\n *\n * @example\n * // Use Container instead of DataStore on the server\n * import {Container} from 'js-data'\n * import MongoDBAdapter from 'js-data-mongodb'\n *\n * // Create a store to hold your Mappers\n * const store = new Container({\n *   mapperDefaults: {\n *     // MongoDB uses \"_id\" as the primary key\n *     idAttribute: '_id'\n *   }\n * })\n *\n * // Create an instance of MongoDBAdapter with default settings\n * const adapter = new MongoDBAdapter()\n *\n * // Mappers in \"store\" will use the MongoDB adapter by default\n * store.registerAdapter('mongodb', adapter, { default: true })\n *\n * // Create a Mapper that maps to a \"user\" collection\n * store.defineMapper('user')\n *\n * @class MongoDBAdapter\n * @param {Object} [opts] Configuration opts.\n * @param {boolean} [opts.debug=false] Whether to log debugging information.\n * @param {Object} [opts.findOpts] Options to pass to collection#find.\n * @param {Object} [opts.findOneOpts] Options to pass to collection#findOne.\n * @param {Object} [opts.insertOpts] Options to pass to collection#insert.\n * @param {Object} [opts.insertManyOpts] Options to pass to\n * collection#insertMany.\n * @param {boolean} [opts.raw=false] Whether to return detailed result objects\n * instead of just record data.\n * @param {Object} [opts.removeOpts] Options to pass to collection#remove.\n * @param {boolean} [opts.translateId=true] Convert ObjectIDs to strings when\n * pulling records out of the database.\n * @param {Object} [opts.updateOpts] Options to pass to collection#update.\n * @param {string} [opts.uri=\"mongodb://localhost:27017\"] MongoDB URI.\n */\nexport default function MongoDBAdapter (opts) {\n  const self = this\n  opts || (opts = {})\n  if (isString(opts)) {\n    opts = { uri: opts }\n  }\n  fillIn(opts, DEFAULTS)\n  fillIn(self, opts)\n\n  /**\n   * Default options to pass to collection#find.\n   *\n   * @name MongoDBAdapter#findOpts\n   * @type {Object}\n   * @default {}\n   */\n  self.findOpts || (self.findOpts = {})\n  fillIn(self.findOpts, FIND_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to collection#findOne.\n   *\n   * @name MongoDBAdapter#findOneOpts\n   * @type {Object}\n   * @default {}\n   */\n  self.findOneOpts || (self.findOneOpts = {})\n  fillIn(self.findOneOpts, FIND_ONE_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to collection#insert.\n   *\n   * @name MongoDBAdapter#insertOpts\n   * @type {Object}\n   * @default {}\n   */\n  self.insertOpts || (self.insertOpts = {})\n  fillIn(self.insertOpts, INSERT_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to collection#insertMany.\n   *\n   * @name MongoDBAdapter#insertManyOpts\n   * @type {Object}\n   * @default {}\n   */\n  self.insertManyOpts || (self.insertManyOpts = {})\n  fillIn(self.insertManyOpts, INSERT_MANY_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to collection#update.\n   *\n   * @name MongoDBAdapter#updateOpts\n   * @type {Object}\n   * @default {}\n   */\n  self.updateOpts || (self.updateOpts = {})\n  fillIn(self.updateOpts, UPDATE_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to collection#update.\n   *\n   * @name MongoDBAdapter#removeOpts\n   * @type {Object}\n   * @default {}\n   */\n  self.removeOpts || (self.removeOpts = {})\n  fillIn(self.removeOpts, REMOVE_OPTS_DEFAULTS)\n\n  /**\n   * A Promise that resolves to a reference to the MongoDB client being used by\n   * this adapter.\n   *\n   * @name MongoDBAdapter#client\n   * @type {Object}\n   */\n  self.client = new Promise(function (resolve, reject) {\n    MongoClient.connect(opts.uri, function (err, db) {\n      return err ? reject(err) : resolve(db)\n    })\n  })\n}\n\naddHiddenPropsToTarget(MongoDBAdapter.prototype, {\n  /**\n   * Translate ObjectIDs to strings.\n   *\n   * @name MongoDBAdapter#_translateId\n   * @method\n   * @return {*}\n   */\n  _translateId (r, opts) {\n    opts || (opts = {})\n    if (this.getOpt('translateId', opts)) {\n      if (isArray(r)) {\n        r.forEach(function (_r) {\n          const __id = _r._id ? _r._id.toString() : _r._id\n          _r._id = typeof __id === 'string' ? __id : _r._id\n        })\n      } else if (isObject(r)) {\n        const __id = r._id ? r._id.toString() : r._id\n        r._id = typeof __id === 'string' ? __id : r._id\n      }\n    }\n    return r\n  },\n\n  /**\n   * @name MongoDBAdapter#afterCreate\n   * @method\n   */\n  afterCreate: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterCreateMany\n   * @method\n   */\n  afterCreateMany: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterDestroy\n   * @method\n   */\n  afterDestroy: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterDestroyAll\n   * @method\n   */\n  afterDestroyAll: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterFind\n   * @method\n   */\n  afterFind: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterFindAll\n   * @method\n   */\n  afterFindAll: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterUpdate\n   * @method\n   */\n  afterUpdate: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterUpdateAll\n   * @method\n   */\n  afterUpdateAll: noop2,\n\n  /**\n   * @name MongoDBAdapter#afterUpdateMany\n   * @method\n   */\n  afterUpdateMany: noop2,\n\n  /**\n   * @name MongoDBAdapter#beforeCreate\n   * @method\n   */\n  beforeCreate: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeCreateMany\n   * @method\n   */\n  beforeCreateMany: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeDestroy\n   * @method\n   */\n  beforeDestroy: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeDestroyAll\n   * @method\n   */\n  beforeDestroyAll: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeFind\n   * @method\n   */\n  beforeFind: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeFindAll\n   * @method\n   */\n  beforeFindAll: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeUpdate\n   * @method\n   */\n  beforeUpdate: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeUpdateAll\n   * @method\n   */\n  beforeUpdateAll: noop,\n\n  /**\n   * @name MongoDBAdapter#beforeUpdateMany\n   * @method\n   */\n  beforeUpdateMany: noop,\n\n  /**\n   * @name MongoDBAdapter#dbg\n   * @method\n   */\n  dbg (...args) {\n    this.log('debug', ...args)\n  },\n\n  /**\n   * Return a Promise that resolves to a reference to the MongoDB client being\n   * used by this adapter.\n   *\n   * Useful when you need to do anything custom with the MongoDB client library.\n   *\n   * @name MongoDBAdapter#getClient\n   * @method\n   * @return {Object} MongoDB client.\n   */\n  getClient () {\n    return this.client\n  },\n\n  /**\n   * Map filtering params in a selection query to MongoDB a filtering object.\n   *\n   * Handles the following:\n   *\n   * - where\n   *   - and bunch of filtering operators\n   *\n   * @name MongoDBAdapter#getQuery\n   * @method\n   * @return {Object}\n   */\n  getQuery (mapper, query) {\n    query = plainCopy(query || {})\n    query.where || (query.where = {})\n\n    forOwn(query, function (config, keyword) {\n      if (reserved.indexOf(keyword) === -1) {\n        if (isObject(config)) {\n          query.where[keyword] = config\n        } else {\n          query.where[keyword] = {\n            '==': config\n          }\n        }\n        delete query[keyword]\n      }\n    })\n\n    let mongoQuery = {}\n\n    if (Object.keys(query.where).length !== 0) {\n      forOwn(query.where, function (criteria, field) {\n        if (!isObject(criteria)) {\n          query.where[field] = {\n            '==': criteria\n          }\n        }\n        forOwn(criteria, function (v, op) {\n          if (op === '==' || op === '===' || op === 'contains') {\n            mongoQuery[field] = v\n          } else if (op === '!=' || op === '!==' || op === 'notContains') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$ne = v\n          } else if (op === '>') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$gt = v\n          } else if (op === '>=') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$gte = v\n          } else if (op === '<') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$lt = v\n          } else if (op === '<=') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$lte = v\n          } else if (op === 'in') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$in = v\n          } else if (op === 'notIn') {\n            mongoQuery[field] = mongoQuery[field] || {}\n            mongoQuery[field].$nin = v\n          } else if (op === '|==' || op === '|===' || op === '|contains') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orEqQuery = {}\n            orEqQuery[field] = v\n            mongoQuery.$or.push(orEqQuery)\n          } else if (op === '|!=' || op === '|!==' || op === '|notContains') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orNeQuery = {}\n            orNeQuery[field] = {\n              '$ne': v\n            }\n            mongoQuery.$or.push(orNeQuery)\n          } else if (op === '|>') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orGtQuery = {}\n            orGtQuery[field] = {\n              '$gt': v\n            }\n            mongoQuery.$or.push(orGtQuery)\n          } else if (op === '|>=') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orGteQuery = {}\n            orGteQuery[field] = {\n              '$gte': v\n            }\n            mongoQuery.$or.push(orGteQuery)\n          } else if (op === '|<') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orLtQuery = {}\n            orLtQuery[field] = {\n              '$lt': v\n            }\n            mongoQuery.$or.push(orLtQuery)\n          } else if (op === '|<=') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orLteQuery = {}\n            orLteQuery[field] = {\n              '$lte': v\n            }\n            mongoQuery.$or.push(orLteQuery)\n          } else if (op === '|in') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orInQuery = {}\n            orInQuery[field] = {\n              '$in': v\n            }\n            mongoQuery.$or.push(orInQuery)\n          } else if (op === '|notIn') {\n            mongoQuery.$or = mongoQuery.$or || []\n            let orNinQuery = {}\n            orNinQuery[field] = {\n              '$nin': v\n            }\n            mongoQuery.$or.push(orNinQuery)\n          }\n        })\n      })\n    }\n\n    return mongoQuery\n  },\n\n  /**\n   * Logging utility method.\n   *\n   * @name MongoDBAdapter#log\n   * @method\n   */\n  log (level, ...args) {\n    if (level && !args.length) {\n      args.push(level)\n      level = 'debug'\n    }\n    if (level === 'debug' && !this.debug) {\n      return\n    }\n    const prefix = `${level.toUpperCase()}: (MongoDBAdapter)`\n    if (console[level]) {\n      console[level](prefix, ...args)\n    } else {\n      console.log(prefix, ...args)\n    }\n  },\n\n  /**\n   * Map non-filtering params in a selection query to MongoDB query options.\n   *\n   * Handles the following:\n   *\n   * - limit\n   * - skip/offset\n   * - orderBy/sort\n   *\n   * @name MongoDBAdapter#getQueryOptions\n   * @method\n   * @return {Object}\n   */\n  getQueryOptions (mapper, query) {\n    query = plainCopy(query || {})\n    query.orderBy = query.orderBy || query.sort\n    query.skip = query.skip || query.offset\n\n    let queryOptions = {}\n\n    if (query.orderBy) {\n      if (isString(query.orderBy)) {\n        query.orderBy = [\n          [query.orderBy, 'asc']\n        ]\n      }\n      for (var i = 0; i < query.orderBy.length; i++) {\n        if (isString(query.orderBy[i])) {\n          query.orderBy[i] = [query.orderBy[i], 'asc']\n        }\n      }\n      queryOptions.sort = query.orderBy\n    }\n\n    if (query.skip) {\n      queryOptions.skip = +query.skip\n    }\n\n    if (query.limit) {\n      queryOptions.limit = +query.limit\n    }\n\n    return queryOptions\n  },\n\n  /**\n   * Resolve the value of the specified option based on the given options and\n   * this adapter's settings.\n   *\n   * @name MongoDBAdapter#getOpt\n   * @method\n   * @param {string} opt The name of the option.\n   * @param {Object} [opts] Configuration options.\n   * @return {*} The value of the specified option.\n   */\n  getOpt (opt, opts) {\n    opts || (opts = {})\n    return isUndefined(opts[opt]) ? plainCopy(this[opt]) : plainCopy(opts[opt])\n  },\n\n  /**\n   * Turn an _id into an ObjectID if it isn't already an ObjectID.\n   *\n   * @name MongoDBAdapter#toObjectID\n   * @method\n   * @return {*}\n   */\n  toObjectID (mapper, id) {\n    if (id !== undefined && mapper.idAttribute === '_id' && typeof id === 'string' && ObjectID.isValid(id) && !(id instanceof ObjectID)) {\n      return new ObjectID(id)\n    }\n    return id\n  },\n\n  /**\n   * Return the foreignKey from the given record for the provided relationship.\n   *\n   * If the foreignKeys in your database are saved as ObjectIDs, then override\n   * this method and change it to something like:\n   *\n   * ```\n   * return this.toObjectID(mapper, this.constructor.prototype.makeHasManyForeignKey.call(this, mapper, def, record))\n   * ```\n   *\n   * There may be other reasons why you may want to override this method, like\n   * when the id of the parent doesn't exactly match up to the key on the child.\n   *\n   * @name MongoDBAdapter#makeHasManyForeignKey\n   * @method\n   * @return {*}\n   */\n  makeHasManyForeignKey (mapper, def, record) {\n    return def.getForeignKey(record)\n  },\n\n  /**\n   * Return the foreignKeys from the given record for the provided relationship.\n   *\n   * @name MongoDBAdapter#makeHasManyForeignKeys\n   * @method\n   * @return {*}\n   */\n  makeHasManyForeignKeys (mapper, def, record) {\n    return get(record, mapper.idAttribute)\n  },\n\n  /**\n   * Load a hasMany relationship.\n   *\n   * @name MongoDBAdapter#loadHasMany\n   * @method\n   * @return {Promise}\n   */\n  loadHasMany (mapper, def, records, __opts) {\n    const self = this\n    let singular = false\n\n    if (isObject(records) && !isArray(records)) {\n      singular = true\n      records = [records]\n    }\n    const IDs = records.map(function (record) {\n      return self.makeHasManyForeignKey(mapper, def, record)\n    })\n    const query = {}\n    const criteria = query[def.foreignKey] = {}\n    if (singular) {\n      // more efficient query when we only have one record\n      criteria['=='] = IDs[0]\n    } else {\n      criteria['in'] = IDs.filter(function (id) {\n        return id\n      })\n    }\n    return self.findAll(def.getRelation(), query, __opts).then(function (relatedItems) {\n      records.forEach(function (record) {\n        let attached = []\n        // avoid unneccesary iteration when we only have one record\n        if (singular) {\n          attached = relatedItems\n        } else {\n          relatedItems.forEach(function (relatedItem) {\n            if (get(relatedItem, def.foreignKey) === record[mapper.idAttribute]) {\n              attached.push(relatedItem)\n            }\n          })\n        }\n        def.setLocalField(record, attached)\n      })\n    })\n  },\n\n  /**\n   * Load a hasOne relationship.\n   *\n   * @name MongoDBAdapter#loadHasOne\n   * @method\n   * @return {Promise}\n   */\n  loadHasOne (mapper, def, records, __opts) {\n    if (isObject(records) && !isArray(records)) {\n      records = [records]\n    }\n    return this.loadHasMany(mapper, def, records, __opts).then(function () {\n      records.forEach(function (record) {\n        const relatedData = def.getLocalField(record)\n        if (isArray(relatedData) && relatedData.length) {\n          def.setLocalField(record, relatedData[0])\n        }\n      })\n    })\n  },\n\n  /**\n   * Return the foreignKey from the given record for the provided relationship.\n   *\n   * @name MongoDBAdapter#makeBelongsToForeignKey\n   * @method\n   * @return {*}\n   */\n  makeBelongsToForeignKey (mapper, def, record) {\n    return this.toObjectID(def.getRelation(), def.getForeignKey(record))\n  },\n\n  /**\n   * Load a belongsTo relationship.\n   *\n   * @name MongoDBAdapter#loadBelongsTo\n   * @method\n   * @return {Promise}\n   */\n  loadBelongsTo (mapper, def, records, __opts) {\n    const self = this\n    const relationDef = def.getRelation()\n\n    if (isObject(records) && !isArray(records)) {\n      const record = records\n      return self.find(relationDef, self.makeBelongsToForeignKey(mapper, def, record), __opts).then(function (relatedItem) {\n        def.setLocalField(record, relatedItem)\n      })\n    } else {\n      const keys = records.map(function (record) {\n        return self.makeBelongsToForeignKey(mapper, def, record)\n      }).filter(function (key) {\n        return key\n      })\n      return self.findAll(relationDef, {\n        where: {\n          [relationDef.idAttribute]: {\n            'in': keys\n          }\n        }\n      }, __opts).then(function (relatedItems) {\n        records.forEach(function (record) {\n          relatedItems.forEach(function (relatedItem) {\n            if (relatedItem[relationDef.idAttribute] === record[def.foreignKey]) {\n              def.setLocalField(record, relatedItem)\n            }\n          })\n        })\n      })\n    }\n  },\n\n  /**\n   * Retrieve the record with the given primary key.\n   *\n   * @name MongoDBAdapter#find\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {(string|number)} id Primary key of the record to retrieve.\n   * @param {Object} [opts] Configuration options.\n   * @param {Object} [opts.findOneOpts] Options to pass to collection#findOne.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {string[]} [opts.with=[]] Relations to eager load.\n   * @return {Promise}\n   */\n  find (mapper, id, opts) {\n    const self = this\n    let record, op\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    const findOneOpts = self.getOpt('findOneOpts', opts)\n    findOneOpts.fields || (findOneOpts.fields = {})\n\n    return self.getClient().then(function (client) {\n      // beforeFind lifecycle hook\n      op = opts.op = 'beforeFind'\n      return resolve(self[op](mapper, id, opts)).then(function () {\n        return new Promise(function (resolve, reject) {\n          let mongoQuery = {}\n          mongoQuery[mapper.idAttribute] = self.toObjectID(mapper, id)\n          client.collection(mapper.table || underscore(mapper.name)).findOne(mongoQuery, findOneOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      })\n    }).then(function (_record) {\n      if (!_record) {\n        return\n      }\n      record = _record\n      self._translateId(record, opts)\n      const tasks = []\n\n      forEachRelation(mapper, opts, function (def, __opts) {\n        const relatedMapper = def.getRelation()\n        let task\n\n        if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\n          if (def.type === 'hasOne') {\n            task = self.loadHasOne(mapper, def, record, __opts)\n          } else {\n            task = self.loadHasMany(mapper, def, record, __opts)\n          }\n        } else if (def.type === 'hasMany' && def.localKeys) {\n          let localKeys = []\n          let itemKeys = get(record, def.localKeys) || []\n          itemKeys = isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\n          localKeys = localKeys.concat(itemKeys)\n          task = self.findAll(relatedMapper, {\n            where: {\n              [relatedMapper.idAttribute]: {\n                'in': unique(localKeys).filter(function (x) { return x }).map(function (x) { return self.toObjectID(relatedMapper, x) })\n              }\n            }\n          }, __opts).then(function (relatedItems) {\n            def.setLocalField(record, relatedItems)\n          })\n        } else if (def.type === 'hasMany' && def.foreignKeys) {\n          task = self.findAll(relatedMapper, {\n            where: {\n              [def.foreignKeys]: {\n                'contains': self.makeHasManyForeignKeys(mapper, def, record)\n              }\n            }\n          }, __opts).then(function (relatedItems) {\n            def.setLocalField(record, relatedItems)\n          })\n        } else if (def.type === 'belongsTo') {\n          task = self.loadBelongsTo(mapper, def, record, __opts)\n        }\n        if (task) {\n          tasks.push(task)\n        }\n      })\n\n      return Promise.all(tasks)\n    }).then(function () {\n      // afterFind lifecycle hook\n      op = opts.op = 'afterFind'\n      return resolve(self[op](mapper, id, opts, record)).then(function (_record) {\n        // Allow for re-assignment from lifecycle hook\n        record = isUndefined(_record) ? record : _record\n        return self.getOpt('raw', opts) ? {\n          data: record,\n          found: record ? 1 : 0\n        } : record\n      })\n    })\n  },\n\n  /**\n   * Retrieve the records that match the selection query.\n   *\n   * @name MongoDBAdapter#findAll\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} query Selection query.\n   * @param {Object} [opts] Configuration options.\n   * @param {Object} [opts.findOpts] Options to pass to collection#find.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {string[]} [opts.with=[]] Relations to eager load.\n   * @return {Promise}\n   */\n  findAll (mapper, query, opts) {\n    const self = this\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    let records = []\n    let op\n    const findOpts = self.getOpt('findOpts', opts)\n    fillIn(findOpts, self.getQueryOptions(mapper, query))\n    findOpts.fields || (findOpts.fields = {})\n    const mongoQuery = self.getQuery(mapper, query)\n\n    return self.getClient().then(function (client) {\n      // beforeFindAll lifecycle hook\n      op = opts.op = 'beforeFindAll'\n      return resolve(self[op](mapper, query, opts)).then(function () {\n        return new Promise(function (resolve, reject) {\n          client.collection(mapper.table || underscore(mapper.name)).find(mongoQuery, findOpts).toArray(function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      })\n    }).then(function (_records) {\n      records = _records\n      self._translateId(records, opts)\n      const tasks = []\n      forEachRelation(mapper, opts, function (def, __opts) {\n        const relatedMapper = def.getRelation()\n        let task\n        if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\n          if (def.type === 'hasMany') {\n            task = self.loadHasMany(mapper, def, records, __opts)\n          } else {\n            task = self.loadHasOne(mapper, def, records, __opts)\n          }\n        } else if (def.type === 'hasMany' && def.localKeys) {\n          let localKeys = []\n          records.forEach(function (item) {\n            let itemKeys = item[def.localKeys] || []\n            itemKeys = isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\n            localKeys = localKeys.concat(itemKeys)\n          })\n          task = self.findAll(relatedMapper, {\n            where: {\n              [relatedMapper.idAttribute]: {\n                'in': unique(localKeys).filter(function (x) { return x }).map(function (x) { return self.toObjectID(relatedMapper, x) })\n              }\n            }\n          }, __opts).then(function (relatedItems) {\n            records.forEach(function (item) {\n              let attached = []\n              let itemKeys = get(item, def.localKeys) || []\n              itemKeys = isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\n              relatedItems.forEach(function (relatedItem) {\n                if (itemKeys && itemKeys.indexOf(relatedItem[relatedMapper.idAttribute]) !== -1) {\n                  attached.push(relatedItem)\n                }\n              })\n              def.setLocalField(item, attached)\n            })\n            return relatedItems\n          })\n        } else if (def.type === 'hasMany' && def.foreignKeys) {\n          throw new Error('findAll eager load hasMany foreignKeys not supported!')\n        } else if (def.type === 'belongsTo') {\n          task = self.loadBelongsTo(mapper, def, records, __opts)\n        }\n        if (task) {\n          tasks.push(task)\n        }\n      })\n      return Promise.all(tasks)\n    }).then(function () {\n      // afterFindAll lifecycle hook\n      op = opts.op = 'afterFindAll'\n      return resolve(self[op](mapper, query, opts, records)).then(function (_records) {\n        // Allow for re-assignment from lifecycle hook\n        records = isUndefined(_records) ? records : _records\n        return self.getOpt('raw', opts) ? {\n          data: records,\n          found: records.length\n        } : records\n      })\n    })\n  },\n\n  /**\n   * Create a new record.\n   *\n   * @name MongoDBAdapter#create\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} props The record to be created.\n   * @param {Object} [opts] Configuration options.\n   * @param {Object} [opts.insertOpts] Options to pass to collection#insert.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  create (mapper, props, opts) {\n    const self = this\n    let op\n    props || (props = {})\n    opts || (opts = {})\n\n    const insertOpts = self.getOpt('insertOpts', opts)\n\n    return self.getClient().then(function (client) {\n      // beforeCreate lifecycle hook\n      op = opts.op = 'beforeCreate'\n      return resolve(self[op](mapper, props, opts)).then(function (_props) {\n        // Allow for re-assignment from lifecycle hook\n        _props = isUndefined(_props) ? props : _props\n        return new Promise(function (resolve, reject) {\n          const collection = client.collection(mapper.table || underscore(mapper.name))\n          const method = collection.insertOne ? 'insertOne' : 'insert'\n          collection[method](_props, insertOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      }).then(function (cursor) {\n        let record\n        let r = cursor.ops ? cursor.ops : cursor\n        self._translateId(r, opts)\n        record = isArray(r) ? r[0] : r\n\n        // afterCreate lifecycle hook\n        op = opts.op = 'afterCreate'\n        return self[op](mapper, props, opts, record).then(function (_record) {\n          // Allow for re-assignment from lifecycle hook\n          record = isUndefined(_record) ? record : _record\n          const result = {}\n          fillIn(result, cursor)\n          delete result.connection\n          result.data = record\n          result.created = record ? 1 : 0\n          return self.getOpt('raw', opts) ? result : result.data\n        })\n      })\n    })\n  },\n\n  /**\n   * Create multiple records in a single batch.\n   *\n   * @name MongoDBAdapter#createMany\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} props The records to be created.\n   * @param {Object} [opts] Configuration options.\n   * @param {Object} [opts.insertManyOpts] Options to pass to\n   * collection#insertMany.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  createMany (mapper, props, opts) {\n    const self = this\n    let op\n    props || (props = {})\n    opts || (opts = {})\n\n    const insertManyOpts = self.getOpt('insertManyOpts', opts)\n\n    return self.getClient().then(function (client) {\n      // beforeCreateMany lifecycle hook\n      op = opts.op = 'beforeCreateMany'\n      return resolve(self[op](mapper, props, opts)).then(function (_props) {\n        // Allow for re-assignment from lifecycle hook\n        _props = isUndefined(_props) ? props : _props\n        return new Promise(function (resolve, reject) {\n          const collection = client.collection(mapper.table || underscore(mapper.name))\n          collection.insertMany(_props, insertManyOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      }).then(function (cursor) {\n        let records\n        let r = cursor.ops ? cursor.ops : cursor\n        self._translateId(r, opts)\n        records = r\n\n        // afterCreateMany lifecycle hook\n        op = opts.op = 'afterCreateMany'\n        return self[op](mapper, props, opts, records).then(function (_records) {\n          // Allow for re-assignment from lifecycle hook\n          records = isUndefined(_records) ? records : _records\n          const result = {}\n          fillIn(result, cursor)\n          delete result.connection\n          result.data = records\n          result.created = records.length\n          return self.getOpt('raw', opts) ? result : result.data\n        })\n      })\n    })\n  },\n\n  /**\n   * Destroy the record with the given primary key.\n   *\n   * @name MongoDBAdapter#destroy\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {(string|number)} id Primary key of the record to destroy.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {Object} [opts.removeOpts] Options to pass to collection#remove.\n   * @return {Promise}\n   */\n  destroy (mapper, id, opts) {\n    const self = this\n    let op\n    opts || (opts = {})\n    const removeOpts = self.getOpt('removeOpts', opts)\n\n    return self.getClient().then(function (client) {\n      // beforeDestroy lifecycle hook\n      op = opts.op = 'beforeDestroy'\n      return resolve(self[op](mapper, id, opts)).then(function () {\n        return new Promise(function (resolve, reject) {\n          const mongoQuery = {}\n          mongoQuery[mapper.idAttribute] = self.toObjectID(mapper, id)\n          const collection = client.collection(mapper.table || underscore(mapper.name))\n          collection[collection.deleteOne ? 'deleteOne' : 'remove'](mongoQuery, removeOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      })\n    }).then(function (cursor) {\n      // afterDestroy lifecycle hook\n      op = opts.op = 'afterDestroy'\n      return resolve(self[op](mapper, id, opts, cursor)).then(function (_cursor) {\n        // Allow for re-assignment from lifecycle hook\n        return isUndefined(_cursor) ? cursor : _cursor\n      })\n    }).then(function (cursor) {\n      if (cursor) {\n        delete cursor.connection\n      }\n      return self.getOpt('raw', opts) ? cursor : undefined\n    })\n  },\n\n  /**\n   * Destroy the records that match the selection query.\n   *\n   * @name MongoDBAdapter#destroyAll\n   * @method\n   * @param {Object} mapper the mapper.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {Object} [opts.removeOpts] Options to pass to collection#remove.\n   * @return {Promise}\n   */\n  destroyAll (mapper, query, opts) {\n    const self = this\n    let op\n    query || (query = {})\n    opts || (opts = {})\n    const removeOpts = self.getOpt('removeOpts', opts)\n    fillIn(removeOpts, self.getQueryOptions(mapper, query))\n\n    return self.getClient().then(function (client) {\n      // beforeDestroyAll lifecycle hook\n      op = opts.op = 'beforeDestroyAll'\n      return resolve(self[op](mapper, query, opts)).then(function () {\n        const mongoQuery = self.getQuery(mapper, query)\n        return new Promise(function (resolve, reject) {\n          const collection = client.collection(mapper.table || underscore(mapper.name))\n          collection[collection.deleteMany ? 'deleteMany' : 'remove'](mongoQuery, removeOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      })\n    }).then(function (cursor) {\n      // afterDestroyAll lifecycle hook\n      op = opts.op = 'afterDestroyAll'\n      return resolve(self[op](mapper, query, opts, cursor)).then(function (_cursor) {\n        // Allow for re-assignment from lifecycle hook\n        return isUndefined(_cursor) ? cursor : _cursor\n      })\n    }).then(function (cursor) {\n      if (cursor) {\n        delete cursor.connection\n      }\n      return self.getOpt('raw', opts) ? cursor : undefined\n    })\n  },\n\n  /**\n   * Apply the given update to the record with the specified primary key.\n   *\n   * @name MongoDBAdapter#update\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {(string|number)} id The primary key of the record to be updated.\n   * @param {Object} props The update to apply to the record.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {Object} [opts.updateOpts] Options to pass to collection#update.\n   * @return {Promise}\n   */\n  update (mapper, id, props, opts) {\n    const self = this\n    props || (props = {})\n    opts || (opts = {})\n    let op\n    const updateOpts = self.getOpt('updateOpts', opts)\n\n    return self.find(mapper, id, { raw: false }).then(function (record) {\n      if (!record) {\n        throw new Error('Not Found')\n      }\n      // beforeUpdate lifecycle hook\n      op = opts.op = 'beforeUpdate'\n      return resolve(self[op](mapper, id, props, opts))\n    }).then(function (_props) {\n      // Allow for re-assignment from lifecycle hook\n      _props = isUndefined(_props) ? props : _props\n      return self.getClient().then(function (client) {\n        return new Promise(function (resolve, reject) {\n          const mongoQuery = {}\n          mongoQuery[mapper.idAttribute] = self.toObjectID(mapper, id)\n          const collection = client.collection(mapper.table || underscore(mapper.name))\n          collection[collection.updateOne ? 'updateOne' : 'update'](mongoQuery, { $set: _props }, updateOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      })\n    }).then(function (cursor) {\n      if (cursor) {\n        delete cursor.connection\n      }\n      return self.find(mapper, id, { raw: false }).then(function (record) {\n        // afterUpdate lifecycle hook\n        op = opts.op = 'afterUpdate'\n        return resolve(self[op](mapper, id, props, opts, record)).then(function (_record) {\n          // Allow for re-assignment from lifecycle hook\n          record = isUndefined(_record) ? record : _record\n          const result = {}\n          fillIn(result, cursor)\n          result.data = record\n          result.updated = record ? 1 : 0\n          return self.getOpt('raw', opts) ? result : result.data\n        })\n      })\n    })\n  },\n\n  /**\n   * Apply the given update to all records that match the selection query.\n   *\n   * @name MongoDBAdapter#updateAll\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} props The update to apply to the selected records.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {Object} [opts.updateOpts] Options to pass to collection#update.\n   * @return {Promise}\n   */\n  updateAll (mapper, props, query, opts) {\n    const self = this\n    props || (props = {})\n    query || (query = {})\n    opts || (opts = {})\n    let op, ids\n    const updateOpts = self.getOpt('updateOpts', opts)\n    updateOpts.multi = true\n\n    return self.getClient().then(function (client) {\n      const queryOptions = self.getQueryOptions(mapper, query)\n      queryOptions.$set = props\n      const mongoQuery = self.getQuery(mapper, query)\n\n      // beforeUpdateAll lifecycle hook\n      op = opts.op = 'beforeUpdateAll'\n      return resolve(self[op](mapper, props, query, opts)).then(function () {\n        return self.findAll(mapper, query, { raw: false })\n      }).then(function (records) {\n        ids = records.map(function (record) {\n          return self.toObjectID(mapper, record[mapper.idAttribute])\n        })\n\n        return new Promise(function (resolve, reject) {\n          const collection = client.collection(mapper.table || underscore(mapper.name))\n          collection[collection.updateMany ? 'updateMany' : 'update'](mongoQuery, queryOptions, updateOpts, function (err, cursor) {\n            return err ? reject(err) : resolve(cursor)\n          })\n        })\n      }).then(function (cursor) {\n        if (cursor) {\n          delete cursor.connection\n        }\n        const query = {}\n        query[mapper.idAttribute] = {\n          'in': ids\n        }\n        return self.findAll(mapper, query, { raw: false }).then(function (records) {\n          // afterUpdateAll lifecycle hook\n          op = opts.op = 'afterUpdateAll'\n          return self[op](mapper, props, query, opts, records).then(function (_records) {\n            // Allow for re-assignment from lifecycle hook\n            records = isUndefined(_records) ? records : _records\n            const result = {}\n            fillIn(result, cursor)\n            result.data = records\n            result.updated = records.length\n            return self.getOpt('raw', opts) ? result : result.data\n          })\n        })\n      })\n    })\n  },\n\n  /**\n   * Not supported.\n   *\n   * @name MongoDBAdapter#updateMany\n   * @method\n   */\n  updateMany () {\n    throw new Error('not supported!')\n  }\n})\n"],"names":["utils","ObjectID"],"mappings":"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"}